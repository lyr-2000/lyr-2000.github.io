# HTTP3.0

## 出现

## 介绍
HTTP3.0，又称为HTTP over QUIC。HTTP3.0的核心是QUIC协议。我们知道传统的HTTP协议是基于TCP协议的，而QUIC是基于UDP协议，这是HTTP3.0与之前的HTTP协议的一个大区别

## QUIC协议
既然HTTP3.0的核心是QUIC协议，那么我们就要先简单了解一下，什么是QUIC协议

### QUIC协议介绍
QUIC是由Google提出的基于UDP进行多路并发传输的协议，全名quick udp internet connection，从全名就可以看出，QUIC是基于UDP的，翻译过来就是，快速的UDP网络连接。

### 核心优势
QUIC协议的出现，是为了解决现在网络协议中的一些传输层和应用层存在的问题，且几乎不需要应用修改。

#### 1. 等待时延的减少
我们知道，TCP的连接需要三次握手，而如果是加上TLS加密，那在握手阶段的时延会进一步增加。而QUIC协议的连接，只需要让客户端在第一次连接服务端的时候，执行1rt的握手来获取完成握手的所有必要信息。

之所以只需要1rt，是因为UDP本身没有连接这一概念，所以我们可以直接把第一次交互当作连接本身。

#### 2. 优化拥塞控制
在TCP中，我们会对没有在时间内接收到的报文段进行重传，但是，TCP在首次发送的报文段和重传发送的报文段，对应返回的确认报文段是完全一样的，这就导致了我们无法去判断接收到的确认报文段是对应于哪一次发送的报文。

而无法正确判断会对后面的超时重传时间带来影响。
- 如果收到的确认是对原来发送的报文段的确认，却被当前是重传报文段的确认，就会导致计算出来的超时重传时间变短，那么在后面的拥塞控制中，重传报文会被过多地重传。
- 如果收到的是重传报文段的确认，却被当前是对原来发送的报文段的确认，就会导致计算出来的超时重传时间变长，那么在后面的拥塞控制中，如果报文段丢失，那么重传报文段的发送就会等待过久的时间才得以发送出去。

即使这个缺点可以使用Karn算法来进行一定的改进，从而更合理地估测往返时间，但并不代表问题已经解决，而且我们还需要做额外的算法处理。

QUIC为了避免这个问题，对于原始的报文段和重传的报文段的确认报文采用了不同的编号，且每次返回都采用新的编号递增，因此客户端可以通过编号来判断这个确认报文段是对哪个报文段的确认。

#### 3. 优化多路复用
在谈及多路复用的优化之前，我们要先说说HTTP2是如何实现多路复用的

HTTP2引入了帧和流的概念
- 帧：在传输过程中最小的数据单位，每个帧会标识出该帧处于哪个流，且在传输中的顺序
- 流：可以看出是多个帧组成的数据流，在HTTP2中，同一个TCP连接可以有多个流，这也就是可以进行多路复用的原因

虽然采用了多个流，但是HTTP2使用的流，流与流之间是存在依赖关系的，如果其中的一个流出现丢包，那么其后续的帧也会受到影响

而QUIC协议中，同一个连接中的多个流之间是没有依赖关系的，所以当发生丢包的时候，只会影响当前的流，减少了丢包时造成的损失

#### 4. 