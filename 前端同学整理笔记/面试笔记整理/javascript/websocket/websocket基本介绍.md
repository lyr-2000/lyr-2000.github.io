websocket是一个持久连接的协议，全双工
## websocket的连接
websocket的连接是在基于http连接之后，由客户端向服务器发起一次“握手”，告知服务器通信协议发生改变，这个请求报文中包含**Upgrade:websocket**，告知服务器通信协议修改为websocket，同时还要发送一个**Sec-WebSocket-Key**来记录握手过程中的键值。

服务端在收到这个请求后，会返回一个状态码为**101**的响应，同时响应中会带着**Upgrade:websocket**，表示协议已经修改完成。

同时，响应的报文中还会带有一个**Sec-WebSocket-Accept**字段，该字段是通过请求报文中的**Upgrade:websocket**字段的值生成的

连接完成之后，就可以直接使用websocket的数据帧来发送数据，因为websocket是全双工的，所以服务端可以不等待客户端发送请求，自己推送数据到客户端。


## 如何在不支持websocket的地方使用websocket
使用ajax轮询和long poll来实现

### ajax轮询
定时地向服务器发起请求
### long poll
发起请求后挂起，等待服务器返回响应后再发下一个请求

## 四个生命周期
* 打开事件： 此事件发生在端点建立新连接时并且在任何其他事件发生之前。
* 消息事件： 此事件接收 WebSocket 对话中另一端发送的消息。它可以发生在 WebSocket 端点接收了打开事件之后并且在接收关闭事件关闭连接之前的任意时刻。
* 错误事件： 此事件在 WebSocket 连接或者端点发生错误时产生。
* 关闭事件： 此事件表示 WebSocket 端点的连接目前正在部分地关闭，它可以由参与连接的任意一个端点发出。