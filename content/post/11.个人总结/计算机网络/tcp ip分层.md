---
title: "tcp 和 ip 分层"
date: 2021-08-17T21:43:55+08:00
draft: false
author: LYR
---

## TCP/IP 网络分层模型

还是先从 TCP/IP 协议开始讲起，一是因为它非常经典，二是因为它是目前事实上的网络通信标准，研究它的实用价值最大。

TCP/IP 当初的设计者真的是非常聪明，创造性地提出了“**分层**”的概念，把复杂的网络通信划分出多个层次，再给每一个层次分配不同的职责，层次内只专心做自己的事情就好，用“分而治之”的思想把一个“大麻烦”拆分成了数个“小麻烦”，从而解决了网络通信的难题。

![image-2021081722084006](https://cdn.jsdelivr.net/gh/lyr-2000/images_repo_2021_ASUS/2021_08_17_22__08_40image-20210817220840066.png)









TCP/IP 发明于 1970 年代，当时除了它还有很多其他的网络协议，整个网络世界比较混乱。

这个时候国际标准组织（ISO）注意到了这种现象，**感觉“野路子”太多**，就想要来个“大一统”。于是设计出了一个新的网络分层模型，想用这个新框架来统一既存的各种网络协议。

OSI 模型分成了七层，部分层次与 TCP/IP 很像，从下到上分别是：





1. 第一层：物理层，网络的物理形式，例如电缆、光纤、网卡、集线器等等；
2. 第二层：数据链路层，它基本相当于 TCP/IP 的链接层；
3. 第三层：网络层，相当于 TCP/IP 里的网际层；
4. 第四层：传输层，相当于 TCP/IP 里的传输层；
5. 第五层：会话层，维护网络中的连接状态，即保持会话和同步；
6. 第六层：表示层，把数据转换为合适、可理解的语法和语义；
7. 第七层：应用层，面向具体的应用传输数据。







![image-20210817221111447](https://cdn.jsdelivr.net/gh/lyr-2000/images_repo_2021_ASUS/2021_08_17_22__11_11image-20210817221111447.png)





## 两个分层模型的映射关系

现在我们有了两个网络分层模型：TCP/IP 和 OSI，新的问题又出现了，一个是四层模型，一个是七层模型，这两者应该如何互相映射或者说互相解释呢？

好在 OSI 在设计之初就参考了 TCP/IP 等多个协议，可以比较容易但不是很精确地实现对应关系。

1. 第一层：物理层，TCP/IP 里无对应；
2. 第二层：数据链路层，对应 TCP/IP 的链接层；
3. 第三层：网络层，对应 TCP/IP 的网际层；
4. 第四层：传输层，对应 TCP/IP 的传输层；
5. 第五、六、七层：统一对应到 TCP/IP 的应用层。



![image-20210817221443832](https://cdn.jsdelivr.net/gh/lyr-2000/images_repo_2021_ASUS/2021_08_17_22__14_43image-20210817221443832.png)



### 问题解释



有一个辨别四层和七层比较好的（但不是绝对的）小窍门，“**两个凡是**”：凡是由操作系统负责处理的就是四层或四层以下，否则，凡是需要由应用程序（也就是你自己写代码）负责处理的就是七层。





1. 你能用自己的话解释一下“二层转发”“三层路由”吗？

   ​	1 二层转发：设备工作在链路层，帧在经过交换机设备时，检查帧的头部信息，拿到目标mac地址，进行本地转发和广播
   ​	2 三层路由：设备工作在ip层，报文经过有路由功能的设备时，设备分析报文中的头部信息，拿到ip地址，根据网段范围，进行本地转发或选择下一个网关

2. 你认为上一讲中的 DNS 协议位于哪一层呢？

3. 你认为 CDN 工作在那一层呢？

   - DNS和CDN都处于应用层
     - 理由1:我理解的是传输层只知道IP和端口，和URI相关的都是应用层了;
     - 理由2：cdn是“内容分发网络”，要看到内容就必须在应用层。

   



#### 关于 tcp/ip 协议的理解

关于tcp/ip的层次，有说4层，也有说5层的， 可以参见wiki。









