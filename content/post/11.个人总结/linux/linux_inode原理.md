---
title: "linux inode原理"
date: 2021-08-17T13:48:22+08:00
draft: false
author: LYR
---



## 什么是 inode 

`inode`包含很多的文件元信息，但不包含文件名，例如：字节数、属主`UserID`、属组`GroupID`、读写执行权限、时间戳等。

而文件名存放在目录当中，但`Linux`系统内部不使用文件名，而是使用`inode号码`识别文件。对于系统来说文件名只是`inode号码`便于识别的别称。



linux 如何唯一定义一个文件？ 

用 inode 来做

# inode 号码[#](https://www.cnblogs.com/llife/p/11470668.html#inode-号码)

表面上，用户通过文件名打开文件，实际上，系统内部将这个过程分为三步：

1.系统找到这个文件名对应的`inode`号码；
2.通过`inode`号码，获取`inode`信息；
3.根据`inode`信息，找到文件数据所在的`block`，并读出数据。

其实系统还要根据`inode`信息，看用户是否具有访问的权限，有就指向对应的数据`block`，没有就返回权限拒绝。

`inode`也会消耗硬盘空间，所以格式化的时候，操作系统自动将硬盘分成两个区域。一个是数据区，存放文件数据；另一个是`inode`区，存放`inode`所包含的信息。每个`inode`的大小，一般是`128`字节或`256`字节。通常情况下不需要关注单个`inode`的大小，而是需要重点关注`inode`总数。`inode`总数在格式化的时候就确定了。



# 硬链接与软链接[#](https://www.cnblogs.com/llife/p/11470668.html#硬链接与软链接)

## 硬链接[#](https://www.cnblogs.com/llife/p/11470668.html#硬链接)

通过文件系统的`inode`链接来产生的新的文件名，而不是产生新的文件，称为硬链接。

一般情况下，每个`inode`号码对应一个文件名，但是`Linux`允许多个文件名指向同一个`inode`号码。意味着可以使用不同的文件名访问相同的内容。

运行该命令以后，源文件与目标文件的`inode`号码相同，都指向同一个`inode`。`inode`信息中的链接数这时就会增加`1`。

当一个文件拥有多个硬链接时，对文件内容修改，会影响到所有文件名；但是删除一个文件名，不影响另一个文件名的访问。删除一个文件名，只会使得`inode`中的链接数减`1`。

需要注意的是不能对目录做硬链接。

通过`mkdir`命令创建一个新目录，其硬链接数应该有`2`个，因为常见的目录本身为`1`个硬链接，而目录下面的隐藏目录`.（点号）`是该目录的又一个硬链接，也算是`1`个连接数。



![https://img2018.cnblogs.com/blog/1075436/201905/1075436-20190529142818988-1661438024.png](https://img2018.cnblogs.com/blog/1075436/201905/1075436-20190529142818988-1661438024.png)



## 文件系统相关命令行



[参考博客](https://www.cnblogs.com/luoahong/p/10943864.html)



在 Linux 命令的那一节，我们学了一些简单的文件操作的命令，这里我们再来学几个常用的。

首先是**格式化**，也即将一块盘使用命令组织成一定格式的文件系统的过程。咱们买个硬盘或者 U 盘，经常说要先格式化，才能放文件，说的就是这个。

使用 Windows 的时候，咱们常格式化的格式为**NTFS**（New Technology File System）。在 Linux 下面，常用的是 ext3 或者 **ext4**。

当一个 Linux 系统插入了一块没有格式化的硬盘的时候，我们可以通过命令**fdisk -l**，查看格式化和没有格式化的分区。



前面我们讲过，Linux 里面一切都是文件，那从哪里看出是什么文件呢？要从 ls -l 的结果的第一位标识位看出来。

- \- 表示普通文件；
- d 表示文件夹；
- c 表示字符设备文件，这在设备那一节讲解；
- b 表示块设备文件，这也在设备那一节讲解；
- s 表示套接字 socket 文件，这在网络那一节讲解；
- l 表示符号链接，也即软链接，就是通过名字指向另外一个文件，例如下面的代码，instance 这个文件就是指向了 /var/lib/cloud/instances 这个文件。软链接的机制我们这一章会讲解。

```shell
ls -l
# lrwxrwxrwx 1 root root   61 Dec 14 19:53 instance -> /var/lib/cloud/instances
```



![https://img2018.cnblogs.com/blog/1075436/201905/1075436-20190529145430465-2094239338.png](https://img2018.cnblogs.com/blog/1075436/201905/1075436-20190529145430465-2094239338.png)

