<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title> - Even - A super concise theme for Hugo</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="LYR" /><meta name="description" content="[TOC] laravel - åŸºç¡€åŠŸèƒ½ ä¸€. è¡¨å•éªŒè¯ å¿«é€ŸéªŒè¯ è¡¨å•éªŒè¯ è¡¨å•éªŒè¯æ˜¯ä¸€ä¸ªæ¥å—è¡¨å•æ•°æ®çš„å¸¸ç”¨åŠŸèƒ½, ä¸€èˆ¬åœ¨ Controllerå±‚è¿›è¡ŒéªŒè¯. åœ¨ Laravel ä¸­, éªŒè¯è¡¨å•çš„æ–¹æ³•" /><meta name="keywords" content="LYRçš„æ–‡æ¡£ç«™, LYRçš„ä¸ªäººåšå®¢, even" />






<meta name="generator" content="Hugo 0.86.0 with theme even" />


<link rel="canonical" href="http://doc.lyr-2000.xyz/post/10.%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/php/php-laravel/laravel-basic-features/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="" />
<meta property="og:description" content="[TOC] laravel - åŸºç¡€åŠŸèƒ½ ä¸€. è¡¨å•éªŒè¯ å¿«é€ŸéªŒè¯ è¡¨å•éªŒè¯ è¡¨å•éªŒè¯æ˜¯ä¸€ä¸ªæ¥å—è¡¨å•æ•°æ®çš„å¸¸ç”¨åŠŸèƒ½, ä¸€èˆ¬åœ¨ Controllerå±‚è¿›è¡ŒéªŒè¯. åœ¨ Laravel ä¸­, éªŒè¯è¡¨å•çš„æ–¹æ³•" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://doc.lyr-2000.xyz/post/10.%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/php/php-laravel/laravel-basic-features/" /><meta property="article:section" content="post" />



<meta itemprop="name" content="">
<meta itemprop="description" content="[TOC] laravel - åŸºç¡€åŠŸèƒ½ ä¸€. è¡¨å•éªŒè¯ å¿«é€ŸéªŒè¯ è¡¨å•éªŒè¯ è¡¨å•éªŒè¯æ˜¯ä¸€ä¸ªæ¥å—è¡¨å•æ•°æ®çš„å¸¸ç”¨åŠŸèƒ½, ä¸€èˆ¬åœ¨ Controllerå±‚è¿›è¡ŒéªŒè¯. åœ¨ Laravel ä¸­, éªŒè¯è¡¨å•çš„æ–¹æ³•">

<meta itemprop="wordCount" content="5812">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="[TOC] laravel - åŸºç¡€åŠŸèƒ½ ä¸€. è¡¨å•éªŒè¯ å¿«é€ŸéªŒè¯ è¡¨å•éªŒè¯ è¡¨å•éªŒè¯æ˜¯ä¸€ä¸ªæ¥å—è¡¨å•æ•°æ®çš„å¸¸ç”¨åŠŸèƒ½, ä¸€èˆ¬åœ¨ Controllerå±‚è¿›è¡ŒéªŒè¯. åœ¨ Laravel ä¸­, éªŒè¯è¡¨å•çš„æ–¹æ³•"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">LYRçš„æ–‡æ¡£ç«™</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">é¦–é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">å½’æ¡£é¡µ</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">æ ‡ç­¾</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">åˆ†ç±»</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">å…³äº</li>
      </a><a href="/friends">
        <li class="mobile-menu-item">å¤§ä½¬</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">LYRçš„æ–‡æ¡£ç«™</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">é¦–é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">å½’æ¡£é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">æ ‡ç­¾</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">åˆ†ç±»</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">å…³äº</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/friends">å¤§ä½¬</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title"></h1>

      <div class="post-meta">
        <span class="post-time"> 0001-01-01 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#laravel---åŸºç¡€åŠŸèƒ½">laravel - åŸºç¡€åŠŸèƒ½</a></li>
    <li><a href="#ä¸€-è¡¨å•éªŒè¯">ä¸€. è¡¨å•éªŒè¯</a>
      <ul>
        <li><a href="#å¿«é€ŸéªŒè¯">å¿«é€ŸéªŒè¯</a></li>
        <li><a href="#éªŒè¯è¡¨å•è¯·æ±‚">éªŒè¯è¡¨å•è¯·æ±‚</a>
          <ul>
            <li><a href="#è‡ªå®šä¹‰è¿”å›ç»“æœ">è‡ªå®šä¹‰è¿”å›ç»“æœ</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#äºŒ-ä¸­é—´ä»¶">äºŒ. ä¸­é—´ä»¶</a>
      <ul>
        <li><a href="#è‡ªå®šä¹‰ä¸­é—´ä»¶">è‡ªå®šä¹‰ä¸­é—´ä»¶</a></li>
        <li><a href="#auth-ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯æ˜¯å¦ç™»é™†">Auth ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯æ˜¯å¦ç™»é™†</a></li>
        <li><a href="#guest-ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯åªå¯¹æ¸¸å®¢å¼€å‘çš„æ“ä½œ">Guest ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯åªå¯¹æ¸¸å®¢å¼€å‘çš„æ“ä½œ</a></li>
        <li><a href="#verified-ä¸­é—´ä»¶éªŒè¯ç”¨æˆ·é‚®ç®±æ˜¯å¦è¢«éªŒè¯">verified ä¸­é—´ä»¶éªŒè¯ç”¨æˆ·é‚®ç®±æ˜¯å¦è¢«éªŒè¯</a></li>
        <li><a href="#signed-ä¸­é—´ä»¶å®ç°éªŒè¯ç­¾å">signed ä¸­é—´ä»¶å®ç°éªŒè¯ç­¾å</a></li>
        <li><a href="#throttle-ä¸­é—´ä»¶é™åˆ¶è¯·æ±‚æ¬¡æ•°">throttle ä¸­é—´ä»¶é™åˆ¶è¯·æ±‚æ¬¡æ•°</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰-è®°å½•æ—¥å¿—">ä¸‰. è®°å½•æ—¥å¿—</a></li>
    <li><a href="#å››-æ‰‹åŠ¨å‘é€ç”¨æˆ·éªŒè¯é‚®ä»¶">å››. æ‰‹åŠ¨å‘é€ç”¨æˆ·éªŒè¯é‚®ä»¶</a></li>
    <li><a href="#äº”-è‡ªåŠ¨å‘é€ç”¨æˆ·éªŒè¯é‚®ä»¶">äº”. è‡ªåŠ¨å‘é€ç”¨æˆ·éªŒè¯é‚®ä»¶</a>
      <ul>
        <li><a href="#å®ç°åŸç†">å®ç°åŸç†</a></li>
      </ul>
    </li>
    <li><a href="#å…­-å¯†ç é‡ç½®">å…­. å¯†ç é‡ç½®</a></li>
    <li><a href="#ä¸ƒ-åˆ†é¡µ">ä¸ƒ. åˆ†é¡µ</a></li>
    <li><a href="#å…«-æ³¨å†Œç™»é™†è„šæ‰‹æ¶è‡ªåŠ¨ç”Ÿæˆä»£ç ">å…«. æ³¨å†Œç™»é™†è„šæ‰‹æ¶(è‡ªåŠ¨ç”Ÿæˆä»£ç )</a></li>
    <li><a href="#ä¹-è·¯ç”±ç­¾å">ä¹. è·¯ç”±ç­¾å</a></li>
    <li><a href="#åä¸€-ä¸Šä¼ å›¾ç‰‡">åä¸€. ä¸Šä¼ å›¾ç‰‡</a></li>
    <li><a href="#åäºŒ-ç¼“å­˜ç³»ç»Ÿ">åäºŒ. ç¼“å­˜ç³»ç»Ÿ</a>
      <ul>
        <li><a href="#redis-é©±åŠ¨é…ç½®">Redis é©±åŠ¨é…ç½®</a></li>
        <li><a href="#ç¼“å­˜ç›¸å…³å‘½ä»¤">ç¼“å­˜ç›¸å…³å‘½ä»¤</a>
          <ul>
            <li><a href="#æ¸…ç©ºæ‰€æœ‰ç¼“å­˜">æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</a></li>
          </ul>
        </li>
        <li><a href="#ç¼“å­˜çš„ä½¿ç”¨">ç¼“å­˜çš„ä½¿ç”¨</a>
          <ul>
            <li><a href="#å–å€¼-get">å–å€¼ <code>get</code></a></li>
            <li><a href="#è·å–å€¼ä¸”ä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½®-remember">è·å–å€¼ä¸”ä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½® <code>remember</code></a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>[TOC]</p>
<h1 id="laravel---åŸºç¡€åŠŸèƒ½">laravel - åŸºç¡€åŠŸèƒ½</h1>
<h1 id="ä¸€-è¡¨å•éªŒè¯">ä¸€. è¡¨å•éªŒè¯</h1>
<h2 id="å¿«é€ŸéªŒè¯">å¿«é€ŸéªŒè¯</h2>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/6.x/validation/5144">è¡¨å•éªŒè¯</a></p>
</blockquote>
<p>è¡¨å•éªŒè¯æ˜¯ä¸€ä¸ªæ¥å—è¡¨å•æ•°æ®çš„å¸¸ç”¨åŠŸèƒ½, ä¸€èˆ¬åœ¨ <code>Controller</code>å±‚è¿›è¡ŒéªŒè¯. åœ¨ Laravel ä¸­, éªŒè¯è¡¨å•çš„æ–¹æ³•å¦‚ä¸‹ :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="nf">signin</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">){</span>
    <span class="c1">// Request å³ä¸º HTTP è¯·æ±‚å°è£…ç±», è°ƒç”¨å…¶ validate æ–¹æ³•ä¾¿å¯ä»¥å®ŒæˆéªŒè¯
</span><span class="c1"></span>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|max:50&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email|unique:users|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|confirmed|min:6&#39;</span>
    <span class="p">]);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>éªŒè¯æˆåŠŸ : Controller ç»§ç»­æ­£ç¡®æ‰§è¡Œ</li>
<li>éªŒè¯å¤±è´¥ : HTTP Get è¯·æ±‚åˆ™è¿›è¡Œä¸€ä¸ªé‡å®šå‘å“åº”, å¦‚æœä¸º AJAX åˆ™è¿”å›é”™è¯¯çš„ Json ä¿¡æ¯</li>
</ul>
<h2 id="éªŒè¯è¡¨å•è¯·æ±‚">éªŒè¯è¡¨å•è¯·æ±‚</h2>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/6.x/validation/5144#form-request-validation">éªŒè¯è¯·æ±‚è¡¨å•</a></p>
<p><a href="https://learnku.com/laravel/t/42954">formRequest è§£æ</a></p>
<p>é¢å¯¹æ›´å¤æ‚çš„éªŒè¯æƒ…å¢ƒä¸­ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªã€Œè¡¨å•è¯·æ±‚ã€æ¥å¤„ç†æ›´ä¸ºå¤æ‚çš„é€»è¾‘ã€‚è¡¨å•è¯·æ±‚æ˜¯åŒ…å«éªŒè¯é€»è¾‘çš„è‡ªå®šä¹‰è¯·æ±‚ç±»ã€‚å¯ä½¿ç”¨ Artisan å‘½ä»¤ <code>make:request</code> æ¥åˆ›å»ºè¡¨å•è¯·æ±‚ç±»</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># è‡ªå®šä¹‰çš„ç”¨äºå¤„ç†ç”¨æˆ·æ›´æ–°æ•°æ®çš„è¡¨å•éªŒè¯</span>
<span class="c1"># è¿è¡Œåä¼šè‡ªåŠ¨åœ¨ \Http\Requests ä¸‹é¢åˆ›å»º UserUpdateRequest æ–‡ä»¶</span>
php artisan make:request UserUpdateRequest
</code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆçš„ <code>UserUpdateRequest</code> æ–‡ä»¶å¦‚ä¸‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// è‡ªå®šä¹‰è¡¨å•éªŒè¯
</span><span class="c1"></span>    
    
<span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserUpdateRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="sd">/**
</span><span class="sd">     * Determine if the user is authorized to make this request.
</span><span class="sd">     *
</span><span class="sd">     * @return bool
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">authorize</span><span class="p">()</span>
    <span class="p">{</span>	
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
</span><span class="sd">     * Get the validation rules that apply to the request.
</span><span class="sd">     * æ ¸å¿ƒçš„éªŒè¯è§„åˆ™
</span><span class="sd">     * @return array
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="c1">// ä¾‹å¦‚å¯¹å‰ç«¯ä¼ å…¥çš„ name, emial, introduction è¿›è¡ŒéªŒè¯
</span><span class="c1"></span>            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|between:3,25|regex:/^[A-Za-z0-9\-\_]+$/|unique:users,name,&#39;</span> <span class="o">.</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">id</span><span class="p">(),</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email&#39;</span><span class="p">,</span>
            <span class="s1">&#39;introduction&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;max:80&#39;</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
    
    
    <span class="c1">// å¦‚æœä¸è§„å®šåˆ™ä¸ºé»˜è®¤
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">messages</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// è‡ªå®šä¹‰è¿”å›æ¶ˆæ¯
</span><span class="c1"></span>        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;name.unique&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ç”¨æˆ·åå·²è¢«å ç”¨ï¼Œè¯·é‡æ–°å¡«å†™&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name.regex&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ç”¨æˆ·ååªæ”¯æŒè‹±æ–‡ã€æ•°å­—ã€æ¨ªæ å’Œä¸‹åˆ’çº¿ã€‚&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name.between&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ç”¨æˆ·åå¿…é¡»ä»‹äº 3 - 25 ä¸ªå­—ç¬¦ä¹‹é—´ã€‚&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name.required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ç”¨æˆ·åä¸èƒ½ä¸ºç©ºã€‚&#39;</span><span class="p">,</span>
        <span class="p">];</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­éªŒè¯è§„åˆ™æŒ‰ç…§ &lsquo;|&rsquo; çš„å½¢å¼éš”å¼€</p>
<table>
<thead>
<tr>
<th>è§„åˆ™</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>required</td>
<td>å¿…å¡«ä¸ä¸ºç©º</td>
</tr>
<tr>
<td>between:min,max</td>
<td>é•¿åº¦ä½äº min, max ä¹‹é—´</td>
</tr>
<tr>
<td>regex:</td>
<td>æ­£åˆ™éªŒè¯</td>
</tr>
<tr>
<td>email</td>
<td>é‚®ä»¶æ ¼å¼</td>
</tr>
<tr>
<td>max:</td>
<td>æœ€å¤§é•¿åº¦</td>
</tr>
<tr>
<td>unique:table,column,except,idColumn</td>
<td>åœ¨ table æ•°æ®è¡¨é‡Œæ£€æŸ¥ column ï¼Œé™¤äº† idColumn ä¸º except çš„æ•°æ®ã€‚</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// è°ƒç”¨éªŒè¯
</span><span class="c1"></span>

<span class="c1">// IOC è‡ªåŠ¨æ³¨å…¥
</span><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">UserUpdateRequest</span> <span class="nv">$request</span><span class="p">){</span>
    
    <span class="c1">// $data å³ä¸ºéªŒè¯åçš„æ•°æ®
</span><span class="c1"></span>    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">()</span>
    
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="è‡ªå®šä¹‰è¿”å›ç»“æœ">è‡ªå®šä¹‰è¿”å›ç»“æœ</h3>
<blockquote>
<p>å¦‚æœéªŒè¯å¤±è´¥ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªè®©ç”¨æˆ·è¿”å›åˆ°å…ˆå‰çš„ä½ç½®çš„é‡å®šå‘å“åº”ã€‚è¿™äº›é”™è¯¯ä¹Ÿä¼šè¢«é—ªå­˜åˆ° <code>session</code> ä¸­ï¼Œä»¥ä¾¿è¿™äº›é”™è¯¯éƒ½å¯ä»¥åœ¨é¡µé¢ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚å¦‚æœä¼ å…¥çš„è¯·æ±‚æ˜¯ AJAXï¼Œä¼šå‘ç”¨æˆ·è¿”å›å…·æœ‰ 422 çŠ¶æ€ä»£ç å’ŒéªŒè¯é”™è¯¯ä¿¡æ¯çš„ JSON æ•°æ®çš„ HTTP å“åº”ã€‚</p>
</blockquote>
<p>å¦‚æœåœ¨ api è¯·æ±‚ä¸‹ï¼Œæƒ³è‡ªå®šä¹‰è¿”å›çŠ¶æ€ç ï¼Œä»¥åŠè¿”å›æ•°æ®å¯ä»¥é‡å†™è‡ªå®šä¹‰ request ä¸­çš„ <code>failedValidation</code> æ–¹æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">PostStoreRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="sd">/**
</span><span class="sd">     * é‡å†™è‡ªå®šä¹‰ éªŒè¯ä¸é€šè¿‡çš„è¿”å› Json
</span><span class="sd">     * @param Validator $validator
</span><span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">failedValidation</span><span class="p">(</span><span class="nx">Validator</span> <span class="nv">$validator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">HttpResponseException</span><span class="p">(</span><span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">(),</span>
        <span class="p">],</span> <span class="mi">200</span><span class="p">));</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="äºŒ-ä¸­é—´ä»¶">äºŒ. ä¸­é—´ä»¶</h1>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/5.6/middleware/1364">æ‰‹å†Œä¸­çš„ä¸­é—´ä»¶</a></p>
</blockquote>
<p>Laravel ä¸­çš„ä¸­é—´ä»¶ MiddleWare æœ‰å¾ˆå¤šç”¨æ³•, æ¯”è¾ƒå¹¿æ³›çš„æ˜¯ç”¨æ¥è¿‡æ»¤ HTTPè¯·æ±‚.</p>
<p>ä¸­é—´å¯ä»¥åˆ†ä¸º <strong>å…¨å±€ä¸­é—´ä»¶</strong> å’Œ <strong>å±€éƒ¨ä¸­é—´ä»¶</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* --------------- å…¨å±€ä¸­é—´ä»¶ --------------- */</span>
<span class="cm">/*
</span><span class="cm">	å…¨å±€ä¸­é—´ä»¶ä¼šåœ¨äº¤ä»˜ç»™ controller ä¹‹å‰æ‹¦æˆªæ‰€æœ‰çš„ Htpp è¯·æ±‚è¿›è¡Œé€»è¾‘å¤„ç†
</span><span class="cm">	æˆ‘ä»¬å¯ä»¥åœ¨ kernel.php çš„ $middleware æ•°ç»„ä¸­å®šä¹‰æ³¨å†Œå…¨å±€ä¸­é—´ä»¶
</span><span class="cm">*/</span>

<span class="cm">/* ä½äº kernel.php ä¸­, è¿™ä¸ªæ•°æ®ç”¨äºå®šä¹‰æ‰€æœ‰çš„å…¨å±€ä¸­é—´ä»¶ */</span>
<span class="k">protected</span> <span class="nv">$middleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">\App\Http\Middleware\TrustProxies</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\App\Http\Middleware\CheckForMaintenanceMode</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\Illuminate\Foundation\Http\Middleware\ValidatePostSize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\App\Http\Middleware\TrimStrings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="p">];</span>



<span class="cm">/* --------------- å±€éƒ¨ä¸­é—´ä»¶ --------------- */</span>
<span class="cm">/*	
</span><span class="cm">	å±€éƒ¨ä¸­é—´ä»¶åªä½œç”¨äºç‰¹å®šçš„è·¯ç”±è¯·æ±‚.  
</span><span class="cm">	å®šäº kernel.php çš„ $routeMiddleware æ•°ç»„ä¸­
</span><span class="cm">*/</span>
<span class="k">protected</span> <span class="nv">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;auth&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\Authenticate</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;auth.basic&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\AuthenticateWithBasicAuth</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;bindings&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;cache.headers&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Http\Middleware\SetCacheHeaders</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;can&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\Authorize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;guest&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\RedirectIfAuthenticated</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;password.confirm&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\RequirePassword</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;signed&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\ValidateSignature</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;throttle&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\ThrottleRequests</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;verified&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\EnsureEmailIsVerified</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="è‡ªå®šä¹‰ä¸­é—´ä»¶">è‡ªå®šä¹‰ä¸­é—´ä»¶</h2>
<p>æˆ‘ä»¬ä»¥ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸­é—´ä»¶ä¸ºä¾‹å­</p>
<ol>
<li>
<p>é¦–å…ˆ, ä½¿ç”¨ <code>artisan</code> å‘½ä»¤åˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶ <code>EnsureEmailIsVerify</code>  :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">$php</span> artisan make:middleware EnsureEmailIsVerify
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æˆ‘ä»¬å°† <code>EnsureEmailIsVerify</code> å®šä¹‰ä¸ºä¸€ä¸ªå…¨å±€ä¸­é—´ä»¶, åœ¨æ‰€æœ‰è¯·æ±‚è¿‡æ¥çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦éªŒè¯äº†é‚®ç®±</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">protected</span> <span class="nv">$middleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">\App\Http\Middleware\TrustProxies</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\App\Http\Middleware\CheckForMaintenanceMode</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\Illuminate\Foundation\Http\Middleware\ValidatePostSize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\App\Http\Middleware\TrimStrings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>

    <span class="cm">/* åŠ å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„ ä¸­é—´ä»¶*/</span>
    <span class="nx">\App\Http\Middleware\EnsureEmailIsVerified</span><span class="o">::</span><span class="na">class</span>
<span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><p>å…¶å®åœ¨éªŒè¯é‚®ç®±æ–¹é¢, <code>laravel</code> ä¸ºæˆ‘ä»¬ <strong>è‡ªåŠ¨æä¾›äº†éªŒè¯ä¸­é—´ä»¶</strong> =&gt; <code>verified</code>.</p>
<p>è¿™ä¸ªä¸­é—´ä»¶é»˜è®¤æ˜¯æ³¨å†Œåœ¨ <strong>å±€éƒ¨ä¸­é—´ä»¶ä¸­</strong> , è¦å®ç°å’Œä¸Šé¢ç›¸åŒçš„åŠŸèƒ½, æˆ‘ä»¬å°†è¿™ä¸ªç§»åŠ¨åˆ° <strong>å…¨å±€ä¸­é—´ä»¶</strong>å³å¯</p>
</li>
</ol>
<h2 id="auth-ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯æ˜¯å¦ç™»é™†">Auth ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯æ˜¯å¦ç™»é™†</h2>
<p><code>Auth</code> ç±»çš„ä¸­é—´ä»¶åŒæ ·ä¸ºæˆ‘ä»¬æä¾›éå¸¸æ–¹é¢çš„éªŒè¯æ˜¯å¦ç™»é™†æœºåˆ¶, æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™, åªéœ€è¦:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">UsersController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// è¡¨ç¤ºé™¤äº†è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œ å…¶ä»–åœ¨æ‰§è¡Œå‰éƒ½éœ€è¦è°ƒç”¨ä¸­é—´ä»¶ auth
</span><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;except&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">]</span>
        <span class="p">]);</span>
        
        <span class="c1">// Or
</span><span class="c1"></span>        
        <span class="c1">// only ä¸º except çš„åæ–¹æ³•
</span><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;only&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">]</span>
        <span class="p">]);</span>
        
    <span class="p">}</span>
    
    <span class="c1">// ...
</span><span class="c1"></span>    
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æ€ä¹ˆçŸ¥é“ authå¯¹åº”çš„æ˜¯å“ªä¸ªä¸­é—´ä»¶å‘¢.</p>
<p>ä½äº <code>\App\Http\Kernel.php</code>ä¸­ç»™äºˆäº†é…ç½® :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php">    <span class="k">protected</span> <span class="nv">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;auth&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\Authenticate</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;auth.basic&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\AuthenticateWithBasicAuth</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;bindings&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="c1">// ...
</span><span class="c1"></span>    <span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬çœ‹åˆ° <code>auth</code> å¯¹åº”çš„æ˜¯ <code>\App\Http\Middleware\Authenticate::class</code></p>
<p>è€Œè¿™ä¸ªç±»å¹¶æ²¡æœ‰ç»™å‡ºå…·ä½“çš„é€»è¾‘ (ä¸­é—´ä»¶é€»è¾‘å¿…é¡»æ—¶é—´åœ¨ <code>handle</code> æ–¹æ³•ğŸ€„å®ç°):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Auth\Middleware\Authenticate</span> <span class="k">as</span> <span class="nx">Middleware</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Authenticate</span> <span class="k">extends</span> <span class="nx">Middleware</span>
<span class="p">{</span>
    <span class="sd">/**
</span><span class="sd">     * Get the path the user should be redirected to when they are not authenticated.
</span><span class="sd">     *
</span><span class="sd">     * @param  \Illuminate\Http\Request  $request
</span><span class="sd">     * @return string|null
</span><span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">redirectTo</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">expectsJson</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>çœŸæ­£çš„éªŒè¯é€»è¾‘åœ¨åŸºç±» <code>Illuminate\Auth\Middleware\Authenticate</code>ä¸­å®ç°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">Authenticate</span>
<span class="p">{</span>
    <span class="c1">// ...
</span><span class="c1"></span>    
    <span class="c1">// éªŒè¯æ˜¯å¦ç™»é™†
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="o">...</span><span class="nv">$guards</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">authenticate</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$guards</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="guest-ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯åªå¯¹æ¸¸å®¢å¼€å‘çš„æ“ä½œ">Guest ä¸­é—´ä»¶è‡ªåŠ¨éªŒè¯åªå¯¹æ¸¸å®¢å¼€å‘çš„æ“ä½œ</h2>
<p>æœ‰äº›æ“ä½œåªä¼šå¯¹æ¸¸å®¢å¼€å‘, æ¯”å¦‚ç™»é™†åŠŸèƒ½. å’Œ auth ç±»ä¼¼, guest ä¹Ÿæ˜¯ laravelæä¾›çš„ä¸€ä¸ªä¸­é—´ä»¶, å¯¹äºæ¸¸å®¢æ‰æˆæƒ, ç”¨æ³•å¦‚ä¸‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>


<span class="k">class</span> <span class="nc">SessionsController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// è¡¨ç¤º åªæœ‰æœªç™»å½•çš„ç”¨æˆ·æ‰èƒ½è®¿é—® login é¡µé¢
</span><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;guest&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;only&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">]]</span>
        <span class="p">);</span>

    <span class="p">}</span>
	
    
    <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="verified-ä¸­é—´ä»¶éªŒè¯ç”¨æˆ·é‚®ç®±æ˜¯å¦è¢«éªŒè¯">verified ä¸­é—´ä»¶éªŒè¯ç”¨æˆ·é‚®ç®±æ˜¯å¦è¢«éªŒè¯</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeController@index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;verified&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="signed-ä¸­é—´ä»¶å®ç°éªŒè¯ç­¾å">signed ä¸­é—´ä»¶å®ç°éªŒè¯ç­¾å</h2>
<h2 id="throttle-ä¸­é—´ä»¶é™åˆ¶è¯·æ±‚æ¬¡æ•°">throttle ä¸­é—´ä»¶é™åˆ¶è¯·æ±‚æ¬¡æ•°</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 
</span><span class="cm">	throttle ä¸ºlaravelé»˜è®¤æ³¨å†Œçš„å±€éƒ¨ä¸­é—´ä»¶
</span><span class="cm">*/</span>


<span class="cm">/* 
</span><span class="cm">	è¡¨ç¤ºæœ¬æ§åˆ¶å™¨ä¸­çš„registeræ–¹æ³•, é™åˆ¶åœ¨1åˆ†é’Ÿä¹‹å†…åªèƒ½è¯·æ±‚å°äºç­‰äº6æ¬¡
</span><span class="cm">*/</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s2">&#34;throttle:6,1&#34;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">(</span><span class="s2">&#34;register&#34;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="ä¸‰-è®°å½•æ—¥å¿—">ä¸‰. è®°å½•æ—¥å¿—</h1>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/5.6/logging/1374">æ‰‹å†Œä¸­æ—¥å¿—åŠŸèƒ½</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">### å†™å…¥æ—¥å¿—ä¿¡æ¯
</span><span class="c1"></span>
<span class="c1">// è®°å½•çš„æ—¥å¿—ä¸€èˆ¬ä½äº /storage/logs ä¸‹
</span><span class="c1"></span>
<span class="c1">// ä½ å¯ä»¥ä½¿ç”¨ `Log` [é—¨é¢](http://laravelacademy.org/post/8708.html)è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæ—¥å¿—ç³»ç»Ÿæä¾›äº†å®šä¹‰åœ¨ [RFC 5424 è§„èŒƒ](https://tools.ietf.org/html/rfc5424)ä¸­çš„å…«ç§æ—¥å¿—çº§åˆ«ï¼š**emergency**ã€**alert**ã€**critical**ã€**error**ã€**warning**ã€ **notice**ã€**info** å’Œ **debug**ï¼š
</span><span class="c1"></span>
<span class="nx">Log</span><span class="o">::</span><span class="na">emergency</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">alert</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">critical</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">warning</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">notice</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">debug</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>

<span class="c1">// ä¸Šä¸‹æ–‡ä¿¡æ¯
</span><span class="c1"></span>
<span class="c1">// ä¸Šä¸‹æ–‡æ•°æ®ä¹Ÿä¼šä»¥æ•°ç»„å½¢å¼ä¼ é€’ç»™æ—¥å¿—æ–¹æ³•ï¼Œç„¶åå’Œæ—¥å¿—ä¿¡æ¯ä¸€èµ·è¢«æ ¼å¼åŒ–å’Œæ˜¾ç¤ºï¼š
</span><span class="c1"></span>
<span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;User failed to login.&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>
<span class="c1">// å†™å…¥æŒ‡å®šé¢‘é“
</span><span class="c1">// æœ‰æ—¶å€™ä½ å¯èƒ½å¸Œæœ›å°†æ—¥å¿—ä¿¡æ¯è®°å½•åˆ°æŸä¸ªé¢‘é“è€Œä¸æ˜¯åº”ç”¨çš„é»˜è®¤é¢‘é“ã€‚è¦å®ç°è¿™ä¸ªç›®çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨ Log é—¨é¢ä¸Šçš„ // channel æ–¹æ³•æ¥è·å–é…ç½®æ–‡ä»¶å®šä¹‰çš„é¢‘é“å¹¶å°†æ—¥å¿—å†™å…¥è¿›å»ï¼š
</span><span class="c1"></span>
<span class="nx">Log</span><span class="o">::</span><span class="na">channel</span><span class="p">(</span><span class="s1">&#39;slack&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;Something happened!&#39;</span><span class="p">);</span>
<span class="c1">// å¦‚æœä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªç”±å¤šä¸ªé¢‘é“ç»„æˆçš„æŒ‰éœ€æ—¥å¿—å †æ ˆï¼Œå¯ä»¥ä½¿ç”¨ stack æ–¹æ³•ï¼š
</span><span class="c1"></span>
<span class="nx">Log</span><span class="o">::</span><span class="na">stack</span><span class="p">([</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="s1">&#39;slack&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;Something happened!&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="å››-æ‰‹åŠ¨å‘é€ç”¨æˆ·éªŒè¯é‚®ä»¶">å››. æ‰‹åŠ¨å‘é€ç”¨æˆ·éªŒè¯é‚®ä»¶</h1>
<p>å®ç°é‚®ä»¶çš„å‘é€, æˆ‘ä»¬é¦–å…ˆéœ€è¦é…ç½® <code>.env</code> æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">// ä½¿ç”¨ qq é‚®ç®±çš„æœåŠ¡å‘é€é‚®ä»¶
MAIL_DRIVER=smtp
MAIL_HOST=smtp.qq.com
MAIL_PORT=25
MAIL_USERNAME=522500442@qq.com
MAIL_PASSWORD=nkgrxqznbounbidd			// é€šè¿‡ qq é‚®ç®±ç”Ÿæˆçš„éªŒè¯ç 
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=522500442@qq.com
MAIL_FROM_NAME=WeiboApp


// log çš„å½¢å¼å‘é€é‚®ä»¶ (for debug)
MAIL_DRIVER=log 
</code></pre></td></tr></table>
</div>
</div><p><strong>è°ƒç”¨ Mail::send() å‘é€é‚®ä»¶</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nv">$view</span> <span class="o">=</span> <span class="s1">&#39;emails.confirm&#39;</span><span class="p">;</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
<span class="nv">$to</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
<span class="nv">$subject</span> <span class="o">=</span> <span class="s2">&#34;æ„Ÿè°¢æ³¨å†Œ Weibo åº”ç”¨ï¼è¯·ç¡®è®¤ä½ çš„é‚®ç®±ã€‚&#34;</span><span class="p">;</span>

<span class="nx">Mail</span><span class="o">::</span><span class="na">send</span><span class="p">(</span><span class="nv">$view</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$to</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">)</span> <span class="p">{</span>
<span class="nv">$message</span><span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$to</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="nv">$subject</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>ç¼–è¾‘è§†å›¾æ–‡ä»¶ :</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>æ³¨å†Œç¡®è®¤é“¾æ¥<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>æ„Ÿè°¢æ‚¨åœ¨ Weibo App ç½‘ç«™è¿›è¡Œæ³¨å†Œï¼<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
  è¯·ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥å®Œæˆæ³¨å†Œï¼š
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ route(&#39;confirm_email&#39;, $user-&gt;activation_token) }}&#34;</span><span class="p">&gt;</span>
    {{ route(&#39;confirm_email&#39;, $user-&gt;activation_token) }}
  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
  å¦‚æœè¿™ä¸æ˜¯æ‚¨æœ¬äººçš„æ“ä½œï¼Œè¯·å¿½ç•¥æ­¤é‚®ä»¶ã€‚
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="äº”-è‡ªåŠ¨å‘é€ç”¨æˆ·éªŒè¯é‚®ä»¶">äº”. è‡ªåŠ¨å‘é€ç”¨æˆ·éªŒè¯é‚®ä»¶</h1>
<p><code>Larval</code> ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆæ–¹ä¾¿çš„é‚®ä»¶å‘é€åŠŸèƒ½. ä¸»è¦æ˜¯ç”¨æ¥, åšç”¨æˆ·é‚®ä»¶è®¤è¯, ä¸»è¦çš„é€»è¾‘æ˜¯, åœ¨ç”¨æˆ·æ³¨å†Œä¹‹å, ä¾¿ç»™ç”¨æˆ·å‘é€ä¸€å°é‚®ä»¶, ç”±ç”¨æˆ·ç‚¹å¼€åä»è€Œè®¤è¯æˆåŠŸ. ç”¨æˆ·ä¾¿å¯ä»¥æ­£å¸¸ä½¿ç”¨. å¦ä¾§å±äºæœªè®¤è¯è´¦å·.</p>
<p>æ•°æ®åº“å±‚é¢ <code>Laravel</code> è‡ªå¸¦çš„ users æ•°æ®è¡¨å­˜åœ¨å­—æ®µ <code>email_verified_at</code>. ä¾¿æ˜¯è¯¥ç”¨æˆ·æ˜¯å¦è¢«éªŒè¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">ä½¿ç”¨æ–¹æ³•</span> <span class="o">:</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Auth\MustVerifyEmail</span> <span class="k">as</span> <span class="nx">MustVerifyEmailContracts</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Auth\MustVerifyEmail</span> <span class="k">as</span> <span class="nx">MustVerifyEmailTrait</span><span class="p">;</span>

<span class="o">----</span> <span class="mf">1.</span> <span class="nx">User</span> <span class="nx">ç±»å®ç°æ¥å£</span> <span class="nx">Illuminate\Contracts\Auth\MustVerifyEmail</span> <span class="nx">å³å¯</span>
		
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span> <span class="k">implements</span> <span class="nx">MustVerifyEmailContracts</span>
<span class="p">{</span>
    
    
<span class="p">}</span>


<span class="o">----</span> <span class="mf">2.</span> 
    
    <span class="o">-</span> <span class="nx">å¦‚æœåœ¨è€ç‰ˆæœ¬</span><span class="p">,</span> <span class="nx">é‚£ä¹ˆ</span> <span class="nx">User</span> <span class="nx">ç±»è¿˜éœ€è¦</span> <span class="k">use</span> <span class="nx">Illuminate\Auth\MustVerifyEmail</span> <span class="nx">è¿™ä¸ª</span> <span class="nx">trail</span>
    
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span> <span class="k">implements</span> <span class="nx">MustVerifyEmailContracts</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">,</span> <span class="nx">MustVerifyEmailTrait</span>
    
        <span class="o">...</span>
<span class="p">}</span>


	<span class="o">-</span> <span class="nx">æ–°ç‰ˆæœ¬ä¸­</span><span class="p">,</span> <span class="nx">MustVerifyEmailTrait</span> <span class="nx">å·²ç»è¢«é»˜è®¤ç§»æ¤åˆ°</span> <span class="nx">Authenticatable</span> <span class="nx">åŸºç±»ä¸­</span><span class="o">.</span> <span class="nx">å¯ä»¥ä¸ç”¨è‡ªå·±ä½¿ç”¨äº†</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="å®ç°åŸç†">å®ç°åŸç†</h2>
<ul>
<li>
<p>é¦–å…ˆ <code>User</code> ç±»å®ç°äº† <code>MustVerifyEmailContracts</code> è¿™ä¸ªæ¥å£, è¿™ä¸ªæ¥å£åŒ…æ‹¬ 4 ä¸ªæ–¹æ³• :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php">    <span class="sd">/**
</span><span class="sd">     * Determine if the user has verified their email address.
</span><span class="sd">     *
</span><span class="sd">     * @return bool
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">hasVerifiedEmail</span><span class="p">();</span>

    <span class="sd">/**
</span><span class="sd">     * Mark the given user&#39;s email as verified.
</span><span class="sd">     *
</span><span class="sd">     * @return bool
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">markEmailAsVerified</span><span class="p">();</span>

    <span class="sd">/**
</span><span class="sd">     * Send the email verification notification.
</span><span class="sd">     *
</span><span class="sd">     * @return void
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmailVerificationNotification</span><span class="p">();</span>

    <span class="sd">/**
</span><span class="sd">     * Get the email address that should be used for verification.
</span><span class="sd">     *
</span><span class="sd">     * @return string
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getEmailForVerification</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ç„¶å <code>use MustVerifyEmailTrait</code> åˆ†åˆ«å®ç°äº†è¿™å››ä¸ªæ¥å£</p>
</li>
<li>
<p>åœ¨å¤„ç†ç”¨æˆ·æ³¨å†Œçš„ <code>register</code> æ–¹æ³•ä¸­, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€»è¾‘å¦‚ä¸‹ :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* ç”¨æˆ·æ³¨å†Œçš„å¤„ç†æ§åˆ¶å™¨ */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">();</span>

    <span class="cm">/* è¡¨ç¤º register ä¼šå‡ºå‘ä¸€ä¸ªäº‹ä»¶ç³»ç»Ÿ */</span>
    <span class="cm">/* è¯¥äº‹ä»¶å³ä¸º Registered æˆ‘ä»¬å¯ä»¥åœ¨ EventServiceProvider é‡Œé¢æ‰¾åˆ°å®ƒçš„ç›‘å¬å™¨ */</span>
    <span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">Registered</span><span class="p">(</span><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">())));</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">guard</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registered</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$user</span><span class="p">)</span>
        <span class="o">?:</span> <span class="nx">redirect</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectPath</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>laravel</code> åœ¨ <code>EventServiceProvider</code> ä¸­å·²ç»å®šä¹‰äº† <code>Registered</code> çš„ç›‘å¬å™¨ :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="sd">/**
</span><span class="sd">     * The event listener mappings for the application.
</span><span class="sd">     *
</span><span class="sd">     * @var array
</span><span class="sd">     */</span>
<span class="k">protected</span> <span class="nv">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">Registered</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>

        <span class="cm">/* å®šä¹‰äº† event Register çš„ç›‘å¬å™¨ä¸º SendEmailVerificationNotification */</span>
        <span class="nx">SendEmailVerificationNotification</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>è¿›å…¥ <code>SendEmailVerificationNotification</code> å, æˆ‘ä»¬ä¾¿å¯ä»¥çœ‹åˆ° é‚®ä»¶çš„å‘é€é€»è¾‘äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="sd">/**
</span><span class="sd">     * Handle the event.
</span><span class="sd">     *
</span><span class="sd">     * @param  \Illuminate\Auth\Events\Registered  $event
</span><span class="sd">     * @return void
</span><span class="sd">     */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Registered</span> <span class="nv">$event</span><span class="p">)</span>
<span class="p">{</span>	
    <span class="cm">/* å¦‚æœä¼ å…¥çš„ user å®ç°äº†MustVerifyEmailæ¥å£, ä¸”è¿˜æ²¡æœ‰è¢«éªŒè¯é‚®ä»¶ */</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span> <span class="nx">instanceof</span> <span class="nx">MustVerifyEmail</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">hasVerifiedEmail</span><span class="p">())</span> <span class="p">{</span>	
        <span class="cm">/* é‚£ä¹ˆå‘é€é‚®ä»¶éªŒè¯ */</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">sendEmailVerificationNotification</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h1 id="å…­-å¯†ç é‡ç½®">å…­. å¯†ç é‡ç½®</h1>
<p><code>Laravel</code> è‡ªåŠ¨æä¾›äº†å…³äºå¯†ç é‡ç½®çš„æ§åˆ¶å™¨å’Œæ•°æ®è¡¨</p>
<ul>
<li>
<p>å…³äºå¯†ç é‡ç½®çš„æ•°æ®è¡¨ : password_resets ä½äºåŸå§‹çš„è¿ç§»æ–‡ä»¶ä¸­å­—æ®µå¦‚ä¸‹</p>
<p>email | token | created_at</p>
<p>åˆ†åˆ«è®°å½•äº†æ”¶å– token ä»¤ç‰Œçš„é‚®ç®±, tokenä»¤ç‰Œ, ä»¥åŠæ—¶é—´</p>
</li>
<li>
<p>å…³äºå¯†ç é‡ç½®çš„æ§åˆ¶å™¨éƒ½æ˜¯è‡ªå¸¦çš„ä½äº <code>\App\Http\Controller\Auth</code> ä¸‹</p>
<p>å¿˜è®°å¯†ç æ§åˆ¶å™¨ : <code>ForgotPasswordController </code></p>
<p>é‡ç½®å¯†ç æ§åˆ¶å™¨ : <code>ResetPasswordController</code></p>
</li>
<li>
<p>å…³äº laravel è‡ªå¸¦çš„å¯†ç é‡ç½®æ­¥éª¤å¦‚ä¸‹ :</p>
<ol>
<li>
<p>ç”¨æˆ·å¯¹å¯†ç å¿˜è®°é¡µé¢å‘èµ·GETè¯·æ±‚, å¯¹åº”çš„è·¯ç”±ä¸º :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/password/reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ForgotPasswordController@showLinkRequestForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.request&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>ä½†æ˜¯æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰è§†å›¾</strong> : <code>\Auth\Passwords\email.blade.php</code></p>
</li>
<li>
<p>ç”¨æˆ·é€šè¿‡ POST è¯·æ±‚ç»™ Laravel å‘é€æ¥æ”¶ token çš„é‚®ç®±</p>
<p>æˆ‘ä»¬æ¥å—è¿™ä¸ª POST è¯·æ±‚çš„è·¯ç”±ä¸º :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;password/email&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ForgotPasswordController@sendResetLinkEmail&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.email&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Laravel å‘é€ token åˆ°åˆ¶å®šçš„é‚®ç®±</p>
</li>
<li>
<p>ç”¨æˆ·åˆ°é‚®ç®±ä¸­ç‚¹å‡»ç›¸åº”å¸¦ Token çš„é“¾æ¥åˆ°æˆ‘ä»¬çš„é‡ç½®é¡µé¢</p>
<p>è¿™ä¸ª Get è¯·æ±‚å¯¹åº”çš„è·¯ç”±ä¸º:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password/reset/{token}&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ResetPasswordController@showResetForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.reset&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æœ€åå³ä¸ºæˆ‘ä»¬çš„é‡ç½®é¡µé¢</p>
<p>å¯¹åº”çš„ POST è·¯ç”±ä¸º :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">pRoute</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;password/reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ResetPasswordController@reset&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.update&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ä¹Ÿéœ€è¦è‡ªå®šä¹‰è§†å›¾ : <code>Auth\Passwords\reset.blade.php</code></p>
</li>
</ol>
</li>
</ul>
<h1 id="ä¸ƒ-åˆ†é¡µ">ä¸ƒ. åˆ†é¡µ</h1>
<p>æ•°æ®åˆ†é¡µæ˜¯ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„åŠŸèƒ½ <code>Laravel</code> ä¸­çš„åˆ†é¡µåŠŸèƒ½å®ç°å¦‚ä¸‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// åˆ†é¡µåŠŸèƒ½è¯»å–æ•°æ®, ä¸€é¡µ10æ¡æ•°æ®
</span><span class="c1"></span><span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">paginate</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;users.index&#39;</span><span class="p">,</span> <span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div><p>å‰ç«¯ç”¨ :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html">{!! $users-&gt;render() !!}
</code></pre></td></tr></table>
</div>
</div><p>ä¾¿å¯ä»¥ç®—æ˜¯é¡µç , å¦‚ä¸‹æ•ˆæœ :</p>
<img src="/Users/ark/%E6%96%87%E6%A1%A3%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3%E7%AC%94%E8%AE%B0/PHP/php-laravel/img/pages.png" width="400px">
<p>å¯¹åº”çš„è®¿é—® url ä¸º : <code>/users?page=2</code></p>
<h1 id="å…«-æ³¨å†Œç™»é™†è„šæ‰‹æ¶è‡ªåŠ¨ç”Ÿæˆä»£ç ">å…«. æ³¨å†Œç™»é™†è„šæ‰‹æ¶(è‡ªåŠ¨ç”Ÿæˆä»£ç )</h1>
<p><code>Laravel</code> ä¸ºæˆ‘ä»¬è‡ªåŠ¨é›†æˆäº†ç”¨æˆ·çš„ <code>ç™»é™†, æ³¨å†Œ, å¯†ç ä¿®æ”¹, é‚®ä»¶æ¿€æ´»ç­‰åŠŸèƒ½</code>. ä¸”è‡ªåŠ¨æ·»åŠ äº†è§†å›¾ç­‰.</p>
<p>ä½¿ç”¨ <code>artisan</code> ç”Ÿæˆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># ç”ŸæˆåŒ…æ‹¬ ç™»é™†, æ³¨å†Œ, å¯†ç ä¿®æ”¹, å‡½æ•°æ¿€æ´»ç­‰åŠŸèƒ½çš„ä»£ç </span>
<span class="nv">$php</span> artisan ui:auth
</code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆä¿®æ”¹çš„æ–‡ä»¶å¦‚ä¸‹ :</p>
<p><code>route/web.app</code> , <code>resources/view/auth/(å®šä¹‰äº†æ‰€æœ‰é€»è¾‘æœ‰å…³çš„è§†å›¾)</code> , <code>resource/views/home.blade.php(å¯åˆ é™¤)</code></p>
<ul>
<li>å¯¹äº <code>web.app</code> æ–‡ä»¶</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* å¯¹äºæ–‡ä»¶ web.app, ç”Ÿæˆå¦‚ä¸‹ :*/</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s2">&#34;PagesController@root&#34;</span><span class="p">);</span>

<span class="cm">/* åŒ…å«äº†æ³¨å†Œ, ç™»é™†, å¯†ç ä¿®æ”¹, é‚®ä»¶æ¿€æ´»çš„æ‰€æœ‰è·¯ç”± */</span>
<span class="nx">Auth</span><span class="o">::</span><span class="na">routes</span><span class="p">();</span>

<span class="cm">/* è¿™ä¸ªä¸€èˆ¬æ²¡ä»€ä¹ˆç”¨, å› ä¸ºæˆ‘ä»¬å·²ç»æœ‰ä¸»é¡µè·¯ç”±äº† */</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeController@index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/*
</span><span class="cm">	æˆ‘ä»¬å°† Auth::routes(); æ›¿æ¢ä¸ºå¦‚ä¸‹åŠŸèƒ½æ˜¯ä¸€æ ·çš„
</span><span class="cm">*/</span>
<span class="c1">// ç”¨æˆ·èº«ä»½éªŒè¯ç›¸å…³çš„è·¯ç”±
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\LoginController@showLoginForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\LoginController@login&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\LoginController@logout&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">);</span>

<span class="c1">// ç”¨æˆ·æ³¨å†Œç›¸å…³è·¯ç”±
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\RegisterController@showRegistrationForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\RegisterController@register&#39;</span><span class="p">);</span>

<span class="c1">// å¯†ç é‡ç½®ç›¸å…³è·¯ç”±
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password/reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ForgotPasswordController@showLinkRequestForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.request&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;password/email&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ForgotPasswordController@sendResetLinkEmail&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.email&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password/reset/{token}&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ResetPasswordController@showResetForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.reset&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;password/reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ResetPasswordController@reset&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.update&#39;</span><span class="p">);</span>

<span class="c1">// Email è®¤è¯ç›¸å…³è·¯ç”±
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;email/verify&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\VerificationController@show&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;verification.notice&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;email/verify/{id}/{hash}&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\VerificationController@verify&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;verification.verify&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;email/resend&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\VerificationController@resend&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;verification.resend&#39;</span><span class="p">);</span>

</code></pre></td></tr></table>
</div>
</div><h1 id="ä¹-è·¯ç”±ç­¾å">ä¹. è·¯ç”±ç­¾å</h1>
<blockquote>
<p><a href="https://learnku.com/laravel/t/9404/laravel-56-new-function-routing-signature">è·¯ç”±ç­¾å</a></p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€å¥—è®©ç”¨æˆ·å¿«é€Ÿå›å¤æ´»åŠ¨è®¡åˆ’çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¸Œæœ›å‘é€ email è®©æ‰€æœ‰ç”¨æˆ·å¿«é€Ÿå›å¤ â€œå‚åŠ â€ è¿˜æ˜¯ â€œä¸å‚åŠ â€ã€‚ç„¶è€Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›å¼ºè¿«ç”¨æˆ·åœ¨ç¨‹åºå·²ç»é€€å‡ºç™»å½•çš„æƒ…å†µä¸‹éœ€è¦é‡æ–°ç™»å½•æ‰èƒ½ä½œå‡ºå›å¤ã€‚</p>
<p>å³å¯ä»¥åœ¨ä¸ç”¨ç™»é™†çš„æƒ…å†µä¸‹, ä½¿ç”¨URLå®‰å…¨çš„å‘é€å¸¦æœ‰ç”¨æˆ·èº«ä»½çš„ä¿¡æ¯.</p>
</blockquote>
<p>è·¯ç”±ç­¾åå®ç°åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤</p>
<ol>
<li>
<p><strong>URLç”Ÿæˆ :</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* ä½¿ç”¨URLæœåŠ¡ç”Ÿæˆ */</span>
<span class="k">use</span> <span class="nx">\Illuminate\Support\Facades\URL</span><span class="p">;</span>

<span class="cm">/* 
</span><span class="cm">	ä¾¿æ˜¯ç”Ÿæˆçš„URLç­¾åå­—æ®µ
</span><span class="cm">	Signature æ˜¯é€šè¿‡
</span><span class="cm">        1. event.rsvp è·¯ç”±
</span><span class="cm">        2. id 25
</span><span class="cm">        3. user 100
</span><span class="cm">        4. response yes
</span><span class="cm">        5. æ—¶é—´ä¸€ä¸ªå°æ—¶å†… 
</span><span class="cm">	è¿™äº›ä¿¡æ¯åŠ å¯†å¾—åˆ°çš„
</span><span class="cm">*/</span>
<span class="nv">$url</span> <span class="o">=</span> 
    <span class="nx">URL</span><span class="o">::</span><span class="na">temporarySignedRoute</span><span class="p">(</span><span class="s1">&#39;event.rsvp&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addHour</span><span class="p">(),</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span>
        <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;response&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yes&#39;</span>
    <span class="p">]);</span>

<span class="cm">/* å°†æ­¤$url è¿”å›ç»™client */</span>
<span class="k">return</span> <span class="nv">$url</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>å®šä¹‰è·¯ç”±æ¥å— :</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 
</span><span class="cm">	web.php ä¸­å®šä¹‰è·¯ç”±æ¥å—éªŒè¯ç”Ÿæˆçš„URL 
</span><span class="cm">*/</span>

<span class="cm">/* 
</span><span class="cm">	æ­¤æ—¶Httpè¯·æ±‚åœ¨è¢«rsvpæ–¹æ³•å¤„ç†çš„æ—¶å€™, ä¼šè‡ªåŠ¨è°ƒç”¨ signed ä¸­é—´ä»¶å¯¹ç­¾åè¿›è¡ŒéªŒè¯
</span><span class="cm">*/</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;event/{id}/rsvp/{user}/{response}&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s2">&#34;event.rsvp&#34;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;signed&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h1 id="åä¸€-ä¸Šä¼ å›¾ç‰‡">åä¸€. ä¸Šä¼ å›¾ç‰‡</h1>
<p>å‰ç«¯éƒ¨åˆ†éœ€è¦åœ¨ formæ ‡ç­¾ å±æ€§ä¸­åŠ å…¥ï¼Œå¦åˆ™ä¸Šä¼ çš„ä»…ä¸ºå›¾ç‰‡åç§°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html">enctype=&#34;multipart/form-data&#34;
</code></pre></td></tr></table>
</div>
</div><p>åå°éƒ¨åˆ†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// å›¾ç‰‡ä¸Šä¼ çš„å·¥å…·ç±»
</span><span class="c1">// å›¾ç‰‡ä½œä¸º web ä¸­å¯ä»¥è®¿é—®çš„èµ„æºï¼Œä¸€èˆ¬è¢«æ”¾ç½®åˆ° /public/ æ–‡ä»¶å¤¹ä¸‹
</span><span class="c1">// ä¸” url/ è®¿é—®çš„éƒ½æ˜¯ public/ä¸‹çš„èµ„æºï¼Œurl/uploads/ å¯¹åº”åˆ°æœåŠ¡å™¨ä¸Šå³ä¸º url/public/upoloads/ å› ä¸ºå…¶ä»–æ–‡ä»¶å¯¹å¤–éƒ¨å¹¶ä¸å¼€æ”¾
</span><span class="c1"></span>
<span class="k">namespace</span> <span class="nx">App\Handlers</span><span class="p">;</span>
<span class="k">use</span>  <span class="nx">Illuminate\Support\Str</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ImageUploadHandler</span>
<span class="p">{</span>

    <span class="c1">// åªå…è®¸ä»¥ä¸‹åç¼€åçš„å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ 
</span><span class="c1"></span>    <span class="k">protected</span> <span class="nv">$allowed_ext</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;png&#34;</span><span class="p">,</span> <span class="s2">&#34;jpg&#34;</span><span class="p">,</span> <span class="s2">&#34;gif&#34;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">];</span>
	
    <span class="c1">// save å‡½æ•°å¯¹ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡Œç®€å•çš„å¤„ç†ï¼Œä¸”ç§»åŠ¨åˆ°æŒ‡å®šçš„ä½ç½®
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">save</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$folder</span><span class="p">,</span> <span class="nv">$file_prefix</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// æ„å»ºå­˜å‚¨çš„æ–‡ä»¶å¤¹è§„åˆ™ï¼Œå€¼å¦‚ï¼šuploads/images/avatars/201709/21/
</span><span class="c1"></span>        <span class="c1">// æ–‡ä»¶å¤¹åˆ‡å‰²èƒ½è®©æŸ¥æ‰¾æ•ˆç‡æ›´é«˜ã€‚
</span><span class="c1"></span>        <span class="nv">$folder_name</span> <span class="o">=</span> <span class="s2">&#34;uploads/images/</span><span class="si">$folder</span><span class="s2">/&#34;</span> <span class="o">.</span> <span class="nx">date</span><span class="p">(</span><span class="s2">&#34;Ym/d&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">());</span>

        <span class="c1">// æ–‡ä»¶å…·ä½“å­˜å‚¨çš„ç‰©ç†è·¯å¾„ï¼Œ`public_path()` è·å–çš„æ˜¯ `public` æ–‡ä»¶å¤¹çš„ç‰©ç†è·¯å¾„ã€‚
</span><span class="c1"></span>        <span class="c1">// å€¼å¦‚ï¼š/home/vagrant/Code/larabbs/public/uploads/images/avatars/201709/21/
</span><span class="c1"></span>        <span class="nv">$upload_path</span> <span class="o">=</span> <span class="nx">public_path</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$folder_name</span><span class="p">;</span>

        <span class="c1">// è·å–æ–‡ä»¶çš„åç¼€åï¼Œå› å›¾ç‰‡ä»å‰ªè´´æ¿é‡Œé»è´´æ—¶åç¼€åä¸ºç©ºï¼Œæ‰€ä»¥æ­¤å¤„ç¡®ä¿åç¼€ä¸€ç›´å­˜åœ¨
</span><span class="c1"></span>        <span class="nv">$extension</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalExtension</span><span class="p">())</span> <span class="o">?:</span> <span class="s1">&#39;png&#39;</span><span class="p">;</span>

        <span class="c1">// æ‹¼æ¥æ–‡ä»¶åï¼ŒåŠ å‰ç¼€æ˜¯ä¸ºäº†å¢åŠ è¾¨æåº¦ï¼Œå‰ç¼€å¯ä»¥æ˜¯ç›¸å…³æ•°æ®æ¨¡å‹çš„ ID
</span><span class="c1"></span>        <span class="c1">// å€¼å¦‚ï¼š1_1493521050_7BVc9v9ujP.png
</span><span class="c1"></span>        <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$file_prefix</span> <span class="o">.</span> <span class="s1">&#39;_&#39;</span> <span class="o">.</span> <span class="nx">time</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;_&#39;</span> <span class="o">.</span> <span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$extension</span><span class="p">;</span>

        <span class="c1">// å¦‚æœä¸Šä¼ çš„ä¸æ˜¯å›¾ç‰‡å°†ç»ˆæ­¢æ“ä½œ
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">in_array</span><span class="p">(</span><span class="nv">$extension</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">allowed_ext</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// å°†å›¾ç‰‡ç§»åŠ¨åˆ°æˆ‘ä»¬çš„ç›®æ ‡å­˜å‚¨è·¯å¾„ä¸­
</span><span class="c1"></span>        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span><span class="nv">$upload_path</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">);</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.url&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;/</span><span class="si">$folder_name</span><span class="s2">/</span><span class="si">$filename</span><span class="s2">&#34;</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// åœ¨å¯¹åº”çš„ controller ä¸­æ—¢å¯ä»¥ä½¿ç”¨ IOC çš„æ–¹å¼è¿›è¡Œæ³¨å…¥
</span><span class="c1"></span><span class="k">public</span> <span class="nx">fcuntion</span> <span class="nx">myFunc</span><span class="p">(</span><span class="nx">ImageUploadHandler</span> <span class="nv">$imageUploadHandler</span><span class="p">){</span>
    <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="åäºŒ-ç¼“å­˜ç³»ç»Ÿ">åäºŒ. ç¼“å­˜ç³»ç»Ÿ</h1>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/7.x/cache/7482#driver-prerequisites">ç¼“å­˜ç³»ç»Ÿ</a></p>
<p>Laravel ä¸ºå„ç§åç«¯ç¼“å­˜æä¾›äº†ä¸°å¯Œè€Œç»Ÿä¸€çš„ APIï¼Œå…¶é…ç½®ä¿¡æ¯ä½äº <code>config/cache.php</code> æ–‡ä»¶ä¸­ã€‚åœ¨è¯¥æ–‡ä»¶ä¸­ä½ å¯ä»¥æŒ‡å®šåº”ç”¨é»˜è®¤ä½¿ç”¨å“ªä¸ªç¼“å­˜é©±åŠ¨ã€‚Laravel æ”¯æŒå½“å‰æµè¡Œçš„åç«¯ç¼“å­˜ï¼Œä¾‹å¦‚ <a href="https://memcached.org/">Memcached</a> å’Œ <a href="https://redis.io/">Redis</a> ã€‚</p>
</blockquote>
<p>ç¼“å­˜ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ä½äº <code>cache.php</code> ä¸­ã€‚</p>
<h2 id="redis-é©±åŠ¨é…ç½®">Redis é©±åŠ¨é…ç½®</h2>
<p>é¦–å…ˆéœ€è¦å®‰è£… redis åœ¨ php ä¸­æä¾›çš„å®¢æˆ·ç«¯å¦‚ <code>predis</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.env" data-lang=".env"><span class="c1"># .env é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š</span>

<span class="c1"># ç¼“å­˜ç³»ç»Ÿçš„ driver</span>
<span class="nv">CACHE_DRIVER</span><span class="o">=</span>redis
<span class="nv">REDIS_CLIENT</span><span class="o">=</span>predis
<span class="nv">REDIS_HOST</span><span class="o">=</span>127.0.0.1
<span class="nv">REDIS_PASSWORD</span><span class="o">=</span>null
<span class="nv">REDIS_PORT</span><span class="o">=</span><span class="m">6379</span>
</code></pre></td></tr></table>
</div>
</div><p>å¯¹äº redis çš„é…ç½®æ–‡ä»¶å†™åœ¨ <code>database.php</code> ä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="s1">&#39;redis&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;client&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;phpredis&#39;</span><span class="p">),</span>

    <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;cluster&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLUSTER&#39;</span><span class="p">,</span> <span class="s1">&#39;redis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PREFIX&#39;</span><span class="p">,</span> <span class="nx">Str</span><span class="o">::</span><span class="na">slug</span><span class="p">(</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;laravel&#39;</span><span class="p">),</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;_database_&#39;</span><span class="p">),</span>
    <span class="p">],</span>
	
    
    <span class="cm">/* ä¸€èˆ¬ç”¨é€”çš„ redis ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼Œå¦‚ redis é©±åŠ¨çš„é˜Ÿåˆ— */</span>
    <span class="cm">/* é»˜è®¤ä½¿ç”¨ redis çš„æ•°æ®åº“0 */</span>
    <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_URL&#39;</span><span class="p">),</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
        <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="s1">&#39;6379&#39;</span><span class="p">),</span>
        <span class="s1">&#39;database&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_DB&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
    <span class="p">],</span>
	
    <span class="cm">/* ç¼“å­˜ç³»ç»Ÿ çš„ redis ä½¿ç”¨å¦‚ä¸‹é…ç½® */</span>
    <span class="cm">/* é»˜è®¤ä½¿ç”¨ redis çš„æ•°æ®åº“1 */</span>
    <span class="s1">&#39;cache&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_URL&#39;</span><span class="p">),</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
        <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="s1">&#39;6379&#39;</span><span class="p">),</span>
        <span class="s1">&#39;database&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CACHE_DB&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">),</span>
    <span class="p">],</span>

<span class="p">],</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="ç¼“å­˜ç›¸å…³å‘½ä»¤">ç¼“å­˜ç›¸å…³å‘½ä»¤</h2>
<h3 id="æ¸…ç©ºæ‰€æœ‰ç¼“å­˜">æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">$php</span> artisan cache:clear
</code></pre></td></tr></table>
</div>
</div><h2 id="ç¼“å­˜çš„ä½¿ç”¨">ç¼“å­˜çš„ä½¿ç”¨</h2>
<blockquote>
<p><code>Illuminate\Contracts\Cache\Factory</code> å’Œ <code>Illuminate\Contracts\Cache\Repository</code> <a href="https://learnku.com/docs/laravel/7.x/contracts">å¥‘çº¦</a> æä¾›äº† Laravel ç¼“å­˜æœåŠ¡çš„è®¿é—®æœºåˆ¶ã€‚ <code>Factory</code> å¥‘çº¦ä¸ºä½ çš„åº”ç”¨ç¨‹åºå®šä¹‰äº†è®¿é—®æ‰€æœ‰ç¼“å­˜é©±åŠ¨çš„æœºåˆ¶ã€‚ <code>Repository</code> å¥‘çº¦é€šå¸¸æ˜¯ç”±ä½ çš„ <code>cache</code> é…ç½®æ–‡ä»¶æŒ‡å®šçš„é»˜è®¤ç¼“å­˜é©±åŠ¨å®ç°çš„ã€‚</p>
</blockquote>
<p>###å­˜å€¼ <code>put</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>

<span class="cm">/* 600 ä¸ºè¿‡æœŸæ—¶é—´ï¼Œå³ä¸º10åˆ†é’Ÿ */</span>
<span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Joel&#39;</span><span class="p">,</span> <span class="mi">600</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="å–å€¼-get">å–å€¼ <code>get</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>

<span class="cm">/* å– key ä¸ºnameçš„å€¼ */</span>
<span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="è·å–å€¼ä¸”ä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½®-remember">è·å–å€¼ä¸”ä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½® <code>remember</code></h3>
<p>æœ‰æ—¶ä½ å¯èƒ½æƒ³ä»ç¼“å­˜ä¸­è·å–ä¸€ä¸ªæ•°æ®ï¼Œè€Œå½“è¯·æ±‚çš„ç¼“å­˜é¡¹ä¸å­˜åœ¨æ—¶ï¼Œç¨‹åºèƒ½ä¸ºä½ å­˜å‚¨ä¸€ä¸ªé»˜è®¤å€¼ä½ å¯ä»¥ä½¿ç”¨ <code>Cache::remember</code> æ–¹æ³•æ¥å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/*
</span><span class="cm">ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³ä»ç¼“å­˜ä¸­è·å–æ‰€æœ‰ç”¨æˆ·ï¼Œå½“ç¼“å­˜ä¸­ä¸å­˜åœ¨è¿™äº›ç”¨æˆ·æ—¶ï¼Œç¨‹åºå°†ä»æ•°æ®åº“å°†è¿™äº›ç”¨æˆ·å–å‡ºå¹¶æ”¾å…¥ç¼“å­˜ã€‚
</span><span class="cm">*/</span>

<span class="c1">// userä¸ºè·å–çš„keyå€¼, $seconds ä¸ºè¿‡æœŸæ—¶é—´, åé¢çš„åŒ¿åå‡½æ•°å³ä¸ºä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½®çš„å€¼
</span><span class="c1"></span><span class="nv">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">remember</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nv">$seconds</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// å½“ä¸ä¼ æ—¶é—´çš„æ—¶å€™ï¼Œå³ä¸ºæ°¸ä¹…
</span><span class="c1"></span><span class="nv">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">remember</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">LYR</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        0001-01-01
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        
        <a class="next" href="/post/10.%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/php/php-laravel/laravel-comprehensive-topic/">
            <span class="next-text nav-default"></span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:lyr-2000@qq.com" class="iconfont icon-email" title="email"></a>
  <a href="http://doc.lyr-2000.xyz/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>lyr</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>








</body>
</html>
