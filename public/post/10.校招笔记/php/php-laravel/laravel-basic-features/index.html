<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title> - Even - A super concise theme for Hugo</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="LYR" /><meta name="description" content="[TOC] laravel - 基础功能 一. 表单验证 快速验证 表单验证 表单验证是一个接受表单数据的常用功能, 一般在 Controller层进行验证. 在 Laravel 中, 验证表单的方法" /><meta name="keywords" content="LYR的文档站, LYR的个人博客, even" />






<meta name="generator" content="Hugo 0.86.0 with theme even" />


<link rel="canonical" href="http://doc.lyr-2000.xyz/post/10.%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/php/php-laravel/laravel-basic-features/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="" />
<meta property="og:description" content="[TOC] laravel - 基础功能 一. 表单验证 快速验证 表单验证 表单验证是一个接受表单数据的常用功能, 一般在 Controller层进行验证. 在 Laravel 中, 验证表单的方法" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://doc.lyr-2000.xyz/post/10.%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/php/php-laravel/laravel-basic-features/" /><meta property="article:section" content="post" />



<meta itemprop="name" content="">
<meta itemprop="description" content="[TOC] laravel - 基础功能 一. 表单验证 快速验证 表单验证 表单验证是一个接受表单数据的常用功能, 一般在 Controller层进行验证. 在 Laravel 中, 验证表单的方法">

<meta itemprop="wordCount" content="5812">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="[TOC] laravel - 基础功能 一. 表单验证 快速验证 表单验证 表单验证是一个接受表单数据的常用功能, 一般在 Controller层进行验证. 在 Laravel 中, 验证表单的方法"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">LYR的文档站</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档页</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a><a href="/friends">
        <li class="mobile-menu-item">大佬</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">LYR的文档站</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/friends">大佬</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title"></h1>

      <div class="post-meta">
        <span class="post-time"> 0001-01-01 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#laravel---基础功能">laravel - 基础功能</a></li>
    <li><a href="#一-表单验证">一. 表单验证</a>
      <ul>
        <li><a href="#快速验证">快速验证</a></li>
        <li><a href="#验证表单请求">验证表单请求</a>
          <ul>
            <li><a href="#自定义返回结果">自定义返回结果</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#二-中间件">二. 中间件</a>
      <ul>
        <li><a href="#自定义中间件">自定义中间件</a></li>
        <li><a href="#auth-中间件自动验证是否登陆">Auth 中间件自动验证是否登陆</a></li>
        <li><a href="#guest-中间件自动验证只对游客开发的操作">Guest 中间件自动验证只对游客开发的操作</a></li>
        <li><a href="#verified-中间件验证用户邮箱是否被验证">verified 中间件验证用户邮箱是否被验证</a></li>
        <li><a href="#signed-中间件实现验证签名">signed 中间件实现验证签名</a></li>
        <li><a href="#throttle-中间件限制请求次数">throttle 中间件限制请求次数</a></li>
      </ul>
    </li>
    <li><a href="#三-记录日志">三. 记录日志</a></li>
    <li><a href="#四-手动发送用户验证邮件">四. 手动发送用户验证邮件</a></li>
    <li><a href="#五-自动发送用户验证邮件">五. 自动发送用户验证邮件</a>
      <ul>
        <li><a href="#实现原理">实现原理</a></li>
      </ul>
    </li>
    <li><a href="#六-密码重置">六. 密码重置</a></li>
    <li><a href="#七-分页">七. 分页</a></li>
    <li><a href="#八-注册登陆脚手架自动生成代码">八. 注册登陆脚手架(自动生成代码)</a></li>
    <li><a href="#九-路由签名">九. 路由签名</a></li>
    <li><a href="#十一-上传图片">十一. 上传图片</a></li>
    <li><a href="#十二-缓存系统">十二. 缓存系统</a>
      <ul>
        <li><a href="#redis-驱动配置">Redis 驱动配置</a></li>
        <li><a href="#缓存相关命令">缓存相关命令</a>
          <ul>
            <li><a href="#清空所有缓存">清空所有缓存</a></li>
          </ul>
        </li>
        <li><a href="#缓存的使用">缓存的使用</a>
          <ul>
            <li><a href="#取值-get">取值 <code>get</code></a></li>
            <li><a href="#获取值且不存在的时候设置-remember">获取值且不存在的时候设置 <code>remember</code></a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>[TOC]</p>
<h1 id="laravel---基础功能">laravel - 基础功能</h1>
<h1 id="一-表单验证">一. 表单验证</h1>
<h2 id="快速验证">快速验证</h2>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/6.x/validation/5144">表单验证</a></p>
</blockquote>
<p>表单验证是一个接受表单数据的常用功能, 一般在 <code>Controller</code>层进行验证. 在 Laravel 中, 验证表单的方法如下 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="nf">signin</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">){</span>
    <span class="c1">// Request 即为 HTTP 请求封装类, 调用其 validate 方法便可以完成验证
</span><span class="c1"></span>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|max:50&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email|unique:users|max:255&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|confirmed|min:6&#39;</span>
    <span class="p">]);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>验证成功 : Controller 继续正确执行</li>
<li>验证失败 : HTTP Get 请求则进行一个重定向响应, 如果为 AJAX 则返回错误的 Json 信息</li>
</ul>
<h2 id="验证表单请求">验证表单请求</h2>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/6.x/validation/5144#form-request-validation">验证请求表单</a></p>
<p><a href="https://learnku.com/laravel/t/42954">formRequest 解析</a></p>
<p>面对更复杂的验证情境中，你可以创建一个「表单请求」来处理更为复杂的逻辑。表单请求是包含验证逻辑的自定义请求类。可使用 Artisan 命令 <code>make:request</code> 来创建表单请求类</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 自定义的用于处理用户更新数据的表单验证</span>
<span class="c1"># 运行后会自动在 \Http\Requests 下面创建 UserUpdateRequest 文件</span>
php artisan make:request UserUpdateRequest
</code></pre></td></tr></table>
</div>
</div><p>生成的 <code>UserUpdateRequest</code> 文件如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// 自定义表单验证
</span><span class="c1"></span>    
    
<span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserUpdateRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="sd">/**
</span><span class="sd">     * Determine if the user is authorized to make this request.
</span><span class="sd">     *
</span><span class="sd">     * @return bool
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">authorize</span><span class="p">()</span>
    <span class="p">{</span>	
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
</span><span class="sd">     * Get the validation rules that apply to the request.
</span><span class="sd">     * 核心的验证规则
</span><span class="sd">     * @return array
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="c1">// 例如对前端传入的 name, emial, introduction 进行验证
</span><span class="c1"></span>            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|between:3,25|regex:/^[A-Za-z0-9\-\_]+$/|unique:users,name,&#39;</span> <span class="o">.</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">id</span><span class="p">(),</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email&#39;</span><span class="p">,</span>
            <span class="s1">&#39;introduction&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;max:80&#39;</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
    
    
    <span class="c1">// 如果不规定则为默认
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">messages</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 自定义返回消息
</span><span class="c1"></span>        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;name.unique&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;用户名已被占用，请重新填写&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name.regex&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;用户名只支持英文、数字、横杠和下划线。&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name.between&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;用户名必须介于 3 - 25 个字符之间。&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name.required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;用户名不能为空。&#39;</span><span class="p">,</span>
        <span class="p">];</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>其中验证规则按照 &lsquo;|&rsquo; 的形式隔开</p>
<table>
<thead>
<tr>
<th>规则</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>required</td>
<td>必填不为空</td>
</tr>
<tr>
<td>between:min,max</td>
<td>长度位于 min, max 之间</td>
</tr>
<tr>
<td>regex:</td>
<td>正则验证</td>
</tr>
<tr>
<td>email</td>
<td>邮件格式</td>
</tr>
<tr>
<td>max:</td>
<td>最大长度</td>
</tr>
<tr>
<td>unique:table,column,except,idColumn</td>
<td>在 table 数据表里检查 column ，除了 idColumn 为 except 的数据。</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// 调用验证
</span><span class="c1"></span>

<span class="c1">// IOC 自动注入
</span><span class="c1"></span><span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">UserUpdateRequest</span> <span class="nv">$request</span><span class="p">){</span>
    
    <span class="c1">// $data 即为验证后的数据
</span><span class="c1"></span>    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">()</span>
    
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="自定义返回结果">自定义返回结果</h3>
<blockquote>
<p>如果验证失败，就会生成一个让用户返回到先前的位置的重定向响应。这些错误也会被闪存到 <code>session</code> 中，以便这些错误都可以在页面中显示出来。如果传入的请求是 AJAX，会向用户返回具有 422 状态代码和验证错误信息的 JSON 数据的 HTTP 响应。</p>
</blockquote>
<p>如果在 api 请求下，想自定义返回状态码，以及返回数据可以重写自定义 request 中的 <code>failedValidation</code> 方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">PostStoreRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="sd">/**
</span><span class="sd">     * 重写自定义 验证不通过的返回 Json
</span><span class="sd">     * @param Validator $validator
</span><span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">failedValidation</span><span class="p">(</span><span class="nx">Validator</span> <span class="nv">$validator</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">HttpResponseException</span><span class="p">(</span><span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
            <span class="s1">&#39;errors&#39;</span> <span class="o">=&gt;</span> <span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">(),</span>
        <span class="p">],</span> <span class="mi">200</span><span class="p">));</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="二-中间件">二. 中间件</h1>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/5.6/middleware/1364">手册中的中间件</a></p>
</blockquote>
<p>Laravel 中的中间件 MiddleWare 有很多用法, 比较广泛的是用来过滤 HTTP请求.</p>
<p>中间可以分为 <strong>全局中间件</strong> 和 <strong>局部中间件</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* --------------- 全局中间件 --------------- */</span>
<span class="cm">/*
</span><span class="cm">	全局中间件会在交付给 controller 之前拦截所有的 Htpp 请求进行逻辑处理
</span><span class="cm">	我们可以在 kernel.php 的 $middleware 数组中定义注册全局中间件
</span><span class="cm">*/</span>

<span class="cm">/* 位于 kernel.php 中, 这个数据用于定义所有的全局中间件 */</span>
<span class="k">protected</span> <span class="nv">$middleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">\App\Http\Middleware\TrustProxies</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\App\Http\Middleware\CheckForMaintenanceMode</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\Illuminate\Foundation\Http\Middleware\ValidatePostSize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\App\Http\Middleware\TrimStrings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="p">];</span>



<span class="cm">/* --------------- 局部中间件 --------------- */</span>
<span class="cm">/*	
</span><span class="cm">	局部中间件只作用于特定的路由请求.  
</span><span class="cm">	定于 kernel.php 的 $routeMiddleware 数组中
</span><span class="cm">*/</span>
<span class="k">protected</span> <span class="nv">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;auth&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\Authenticate</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;auth.basic&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\AuthenticateWithBasicAuth</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;bindings&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;cache.headers&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Http\Middleware\SetCacheHeaders</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;can&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\Authorize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;guest&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\RedirectIfAuthenticated</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;password.confirm&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\RequirePassword</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;signed&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\ValidateSignature</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;throttle&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\ThrottleRequests</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="s1">&#39;verified&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\EnsureEmailIsVerified</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="自定义中间件">自定义中间件</h2>
<p>我们以一个自定义的中间件为例子</p>
<ol>
<li>
<p>首先, 使用 <code>artisan</code> 命令创建一个中间件 <code>EnsureEmailIsVerify</code>  :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">$php</span> artisan make:middleware EnsureEmailIsVerify
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>我们将 <code>EnsureEmailIsVerify</code> 定义为一个全局中间件, 在所有请求过来的时候判断是否验证了邮箱</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">protected</span> <span class="nv">$middleware</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">\App\Http\Middleware\TrustProxies</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\App\Http\Middleware\CheckForMaintenanceMode</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\Illuminate\Foundation\Http\Middleware\ValidatePostSize</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\App\Http\Middleware\TrimStrings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="nx">\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>

    <span class="cm">/* 加入我们自定义的 中间件*/</span>
    <span class="nx">\App\Http\Middleware\EnsureEmailIsVerified</span><span class="o">::</span><span class="na">class</span>
<span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><p>其实在验证邮箱方面, <code>laravel</code> 为我们 <strong>自动提供了验证中间件</strong> =&gt; <code>verified</code>.</p>
<p>这个中间件默认是注册在 <strong>局部中间件中</strong> , 要实现和上面相同的功能, 我们将这个移动到 <strong>全局中间件</strong>即可</p>
</li>
</ol>
<h2 id="auth-中间件自动验证是否登陆">Auth 中间件自动验证是否登陆</h2>
<p><code>Auth</code> 类的中间件同样为我们提供非常方面的验证是否登陆机制, 我们使用的时候, 只需要:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">UsersController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 表示除了这三个方法， 其他在执行前都需要调用中间件 auth
</span><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;except&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">]</span>
        <span class="p">]);</span>
        
        <span class="c1">// Or
</span><span class="c1"></span>        
        <span class="c1">// only 为 except 的反方法
</span><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;only&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">]</span>
        <span class="p">]);</span>
        
    <span class="p">}</span>
    
    <span class="c1">// ...
</span><span class="c1"></span>    
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们怎么知道 auth对应的是哪个中间件呢.</p>
<p>位于 <code>\App\Http\Kernel.php</code>中给予了配置 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php">    <span class="k">protected</span> <span class="nv">$routeMiddleware</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;auth&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\Authenticate</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;auth.basic&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Auth\Middleware\AuthenticateWithBasicAuth</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;bindings&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Illuminate\Routing\Middleware\SubstituteBindings</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="c1">// ...
</span><span class="c1"></span>    <span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><p>我们看到 <code>auth</code> 对应的是 <code>\App\Http\Middleware\Authenticate::class</code></p>
<p>而这个类并没有给出具体的逻辑 (中间件逻辑必须时间在 <code>handle</code> 方法🀄实现):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Auth\Middleware\Authenticate</span> <span class="k">as</span> <span class="nx">Middleware</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Authenticate</span> <span class="k">extends</span> <span class="nx">Middleware</span>
<span class="p">{</span>
    <span class="sd">/**
</span><span class="sd">     * Get the path the user should be redirected to when they are not authenticated.
</span><span class="sd">     *
</span><span class="sd">     * @param  \Illuminate\Http\Request  $request
</span><span class="sd">     * @return string|null
</span><span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">redirectTo</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">expectsJson</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>真正的验证逻辑在基类 <code>Illuminate\Auth\Middleware\Authenticate</code>中实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">Authenticate</span>
<span class="p">{</span>
    <span class="c1">// ...
</span><span class="c1"></span>    
    <span class="c1">// 验证是否登陆
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="o">...</span><span class="nv">$guards</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">authenticate</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$guards</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="guest-中间件自动验证只对游客开发的操作">Guest 中间件自动验证只对游客开发的操作</h2>
<p>有些操作只会对游客开发, 比如登陆功能. 和 auth 类似, guest 也是 laravel提供的一个中间件, 对于游客才授权, 用法如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>


<span class="k">class</span> <span class="nc">SessionsController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 表示 只有未登录的用户才能访问 login 页面
</span><span class="c1"></span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;guest&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;only&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">]]</span>
        <span class="p">);</span>

    <span class="p">}</span>
	
    
    <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="verified-中间件验证用户邮箱是否被验证">verified 中间件验证用户邮箱是否被验证</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeController@index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;verified&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="signed-中间件实现验证签名">signed 中间件实现验证签名</h2>
<h2 id="throttle-中间件限制请求次数">throttle 中间件限制请求次数</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 
</span><span class="cm">	throttle 为laravel默认注册的局部中间件
</span><span class="cm">*/</span>


<span class="cm">/* 
</span><span class="cm">	表示本控制器中的register方法, 限制在1分钟之内只能请求小于等于6次
</span><span class="cm">*/</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s2">&#34;throttle:6,1&#34;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">(</span><span class="s2">&#34;register&#34;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="三-记录日志">三. 记录日志</h1>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/5.6/logging/1374">手册中日志功能</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">### 写入日志信息
</span><span class="c1"></span>
<span class="c1">// 记录的日志一般位于 /storage/logs 下
</span><span class="c1"></span>
<span class="c1">// 你可以使用 `Log` [门面](http://laravelacademy.org/post/8708.html)记录日志信息，如上所述，日志系统提供了定义在 [RFC 5424 规范](https://tools.ietf.org/html/rfc5424)中的八种日志级别：**emergency**、**alert**、**critical**、**error**、**warning**、 **notice**、**info** 和 **debug**：
</span><span class="c1"></span>
<span class="nx">Log</span><span class="o">::</span><span class="na">emergency</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">alert</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">critical</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">warning</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">notice</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
<span class="nx">Log</span><span class="o">::</span><span class="na">debug</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>

<span class="c1">// 上下文信息
</span><span class="c1"></span>
<span class="c1">// 上下文数据也会以数组形式传递给日志方法，然后和日志信息一起被格式化和显示：
</span><span class="c1"></span>
<span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;User failed to login.&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>
<span class="c1">// 写入指定频道
</span><span class="c1">// 有时候你可能希望将日志信息记录到某个频道而不是应用的默认频道。要实现这个目的，你可以使用 Log 门面上的 // channel 方法来获取配置文件定义的频道并将日志写入进去：
</span><span class="c1"></span>
<span class="nx">Log</span><span class="o">::</span><span class="na">channel</span><span class="p">(</span><span class="s1">&#39;slack&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;Something happened!&#39;</span><span class="p">);</span>
<span class="c1">// 如果你想要创建一个由多个频道组成的按需日志堆栈，可以使用 stack 方法：
</span><span class="c1"></span>
<span class="nx">Log</span><span class="o">::</span><span class="na">stack</span><span class="p">([</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="s1">&#39;slack&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;Something happened!&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="四-手动发送用户验证邮件">四. 手动发送用户验证邮件</h1>
<p>实现邮件的发送, 我们首先需要配置 <code>.env</code> 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">// 使用 qq 邮箱的服务发送邮件
MAIL_DRIVER=smtp
MAIL_HOST=smtp.qq.com
MAIL_PORT=25
MAIL_USERNAME=522500442@qq.com
MAIL_PASSWORD=nkgrxqznbounbidd			// 通过 qq 邮箱生成的验证码
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=522500442@qq.com
MAIL_FROM_NAME=WeiboApp


// log 的形式发送邮件 (for debug)
MAIL_DRIVER=log 
</code></pre></td></tr></table>
</div>
</div><p><strong>调用 Mail::send() 发送邮件</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nv">$view</span> <span class="o">=</span> <span class="s1">&#39;emails.confirm&#39;</span><span class="p">;</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
<span class="nv">$to</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
<span class="nv">$subject</span> <span class="o">=</span> <span class="s2">&#34;感谢注册 Weibo 应用！请确认你的邮箱。&#34;</span><span class="p">;</span>

<span class="nx">Mail</span><span class="o">::</span><span class="na">send</span><span class="p">(</span><span class="nv">$view</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$to</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">)</span> <span class="p">{</span>
<span class="nv">$message</span><span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$to</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="nv">$subject</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>编辑视图文件 :</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>注册确认链接<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>感谢您在 Weibo App 网站进行注册！<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
  请点击下面的链接完成注册：
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ route(&#39;confirm_email&#39;, $user-&gt;activation_token) }}&#34;</span><span class="p">&gt;</span>
    {{ route(&#39;confirm_email&#39;, $user-&gt;activation_token) }}
  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
  如果这不是您本人的操作，请忽略此邮件。
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="五-自动发送用户验证邮件">五. 自动发送用户验证邮件</h1>
<p><code>Larval</code> 为我们提供了很方便的邮件发送功能. 主要是用来, 做用户邮件认证, 主要的逻辑是, 在用户注册之后, 便给用户发送一封邮件, 由用户点开后从而认证成功. 用户便可以正常使用. 否侧属于未认证账号.</p>
<p>数据库层面 <code>Laravel</code> 自带的 users 数据表存在字段 <code>email_verified_at</code>. 便是该用户是否被验证</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">使用方法</span> <span class="o">:</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Auth\MustVerifyEmail</span> <span class="k">as</span> <span class="nx">MustVerifyEmailContracts</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Auth\MustVerifyEmail</span> <span class="k">as</span> <span class="nx">MustVerifyEmailTrait</span><span class="p">;</span>

<span class="o">----</span> <span class="mf">1.</span> <span class="nx">User</span> <span class="nx">类实现接口</span> <span class="nx">Illuminate\Contracts\Auth\MustVerifyEmail</span> <span class="nx">即可</span>
		
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span> <span class="k">implements</span> <span class="nx">MustVerifyEmailContracts</span>
<span class="p">{</span>
    
    
<span class="p">}</span>


<span class="o">----</span> <span class="mf">2.</span> 
    
    <span class="o">-</span> <span class="nx">如果在老版本</span><span class="p">,</span> <span class="nx">那么</span> <span class="nx">User</span> <span class="nx">类还需要</span> <span class="k">use</span> <span class="nx">Illuminate\Auth\MustVerifyEmail</span> <span class="nx">这个</span> <span class="nx">trail</span>
    
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span> <span class="k">implements</span> <span class="nx">MustVerifyEmailContracts</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">,</span> <span class="nx">MustVerifyEmailTrait</span>
    
        <span class="o">...</span>
<span class="p">}</span>


	<span class="o">-</span> <span class="nx">新版本中</span><span class="p">,</span> <span class="nx">MustVerifyEmailTrait</span> <span class="nx">已经被默认移植到</span> <span class="nx">Authenticatable</span> <span class="nx">基类中</span><span class="o">.</span> <span class="nx">可以不用自己使用了</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="实现原理">实现原理</h2>
<ul>
<li>
<p>首先 <code>User</code> 类实现了 <code>MustVerifyEmailContracts</code> 这个接口, 这个接口包括 4 个方法 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php">    <span class="sd">/**
</span><span class="sd">     * Determine if the user has verified their email address.
</span><span class="sd">     *
</span><span class="sd">     * @return bool
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">hasVerifiedEmail</span><span class="p">();</span>

    <span class="sd">/**
</span><span class="sd">     * Mark the given user&#39;s email as verified.
</span><span class="sd">     *
</span><span class="sd">     * @return bool
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">markEmailAsVerified</span><span class="p">();</span>

    <span class="sd">/**
</span><span class="sd">     * Send the email verification notification.
</span><span class="sd">     *
</span><span class="sd">     * @return void
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sendEmailVerificationNotification</span><span class="p">();</span>

    <span class="sd">/**
</span><span class="sd">     * Get the email address that should be used for verification.
</span><span class="sd">     *
</span><span class="sd">     * @return string
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getEmailForVerification</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>然后 <code>use MustVerifyEmailTrait</code> 分别实现了这四个接口</p>
</li>
<li>
<p>在处理用户注册的 <code>register</code> 方法中, 我们可以看到逻辑如下 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 用户注册的处理控制器 */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">();</span>

    <span class="cm">/* 表示 register 会出发一个事件系统 */</span>
    <span class="cm">/* 该事件即为 Registered 我们可以在 EventServiceProvider 里面找到它的监听器 */</span>
    <span class="nx">event</span><span class="p">(</span><span class="k">new</span> <span class="nx">Registered</span><span class="p">(</span><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">())));</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">guard</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registered</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$user</span><span class="p">)</span>
        <span class="o">?:</span> <span class="nx">redirect</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectPath</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>laravel</code> 在 <code>EventServiceProvider</code> 中已经定义了 <code>Registered</code> 的监听器 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="sd">/**
</span><span class="sd">     * The event listener mappings for the application.
</span><span class="sd">     *
</span><span class="sd">     * @var array
</span><span class="sd">     */</span>
<span class="k">protected</span> <span class="nv">$listen</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">Registered</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>

        <span class="cm">/* 定义了 event Register 的监听器为 SendEmailVerificationNotification */</span>
        <span class="nx">SendEmailVerificationNotification</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>进入 <code>SendEmailVerificationNotification</code> 后, 我们便可以看到 邮件的发送逻辑了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="sd">/**
</span><span class="sd">     * Handle the event.
</span><span class="sd">     *
</span><span class="sd">     * @param  \Illuminate\Auth\Events\Registered  $event
</span><span class="sd">     * @return void
</span><span class="sd">     */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Registered</span> <span class="nv">$event</span><span class="p">)</span>
<span class="p">{</span>	
    <span class="cm">/* 如果传入的 user 实现了MustVerifyEmail接口, 且还没有被验证邮件 */</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span> <span class="nx">instanceof</span> <span class="nx">MustVerifyEmail</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">hasVerifiedEmail</span><span class="p">())</span> <span class="p">{</span>	
        <span class="cm">/* 那么发送邮件验证 */</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">sendEmailVerificationNotification</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h1 id="六-密码重置">六. 密码重置</h1>
<p><code>Laravel</code> 自动提供了关于密码重置的控制器和数据表</p>
<ul>
<li>
<p>关于密码重置的数据表 : password_resets 位于原始的迁移文件中字段如下</p>
<p>email | token | created_at</p>
<p>分别记录了收取 token 令牌的邮箱, token令牌, 以及时间</p>
</li>
<li>
<p>关于密码重置的控制器都是自带的位于 <code>\App\Http\Controller\Auth</code> 下</p>
<p>忘记密码控制器 : <code>ForgotPasswordController </code></p>
<p>重置密码控制器 : <code>ResetPasswordController</code></p>
</li>
<li>
<p>关于 laravel 自带的密码重置步骤如下 :</p>
<ol>
<li>
<p>用户对密码忘记页面发起GET请求, 对应的路由为 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/password/reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ForgotPasswordController@showLinkRequestForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.request&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>但是我们需要自定义视图</strong> : <code>\Auth\Passwords\email.blade.php</code></p>
</li>
<li>
<p>用户通过 POST 请求给 Laravel 发送接收 token 的邮箱</p>
<p>我们接受这个 POST 请求的路由为 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;password/email&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ForgotPasswordController@sendResetLinkEmail&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.email&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Laravel 发送 token 到制定的邮箱</p>
</li>
<li>
<p>用户到邮箱中点击相应带 Token 的链接到我们的重置页面</p>
<p>这个 Get 请求对应的路由为:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password/reset/{token}&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ResetPasswordController@showResetForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.reset&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>最后即为我们的重置页面</p>
<p>对应的 POST 路由为 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">pRoute</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;password/reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ResetPasswordController@reset&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.update&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>我们也需要自定义视图 : <code>Auth\Passwords\reset.blade.php</code></p>
</li>
</ol>
</li>
</ul>
<h1 id="七-分页">七. 分页</h1>
<p>数据分页是一个很常用的功能 <code>Laravel</code> 中的分页功能实现如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// 分页功能读取数据, 一页10条数据
</span><span class="c1"></span><span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">paginate</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;users.index&#39;</span><span class="p">,</span> <span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div><p>前端用 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html">{!! $users-&gt;render() !!}
</code></pre></td></tr></table>
</div>
</div><p>便可以算是页码, 如下效果 :</p>
<img src="/Users/ark/%E6%96%87%E6%A1%A3%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3%E7%AC%94%E8%AE%B0/PHP/php-laravel/img/pages.png" width="400px">
<p>对应的访问 url 为 : <code>/users?page=2</code></p>
<h1 id="八-注册登陆脚手架自动生成代码">八. 注册登陆脚手架(自动生成代码)</h1>
<p><code>Laravel</code> 为我们自动集成了用户的 <code>登陆, 注册, 密码修改, 邮件激活等功能</code>. 且自动添加了视图等.</p>
<p>使用 <code>artisan</code> 生成</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 生成包括 登陆, 注册, 密码修改, 函数激活等功能的代码</span>
<span class="nv">$php</span> artisan ui:auth
</code></pre></td></tr></table>
</div>
</div><p>生成修改的文件如下 :</p>
<p><code>route/web.app</code> , <code>resources/view/auth/(定义了所有逻辑有关的视图)</code> , <code>resource/views/home.blade.php(可删除)</code></p>
<ul>
<li>对于 <code>web.app</code> 文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 对于文件 web.app, 生成如下 :*/</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s2">&#34;PagesController@root&#34;</span><span class="p">);</span>

<span class="cm">/* 包含了注册, 登陆, 密码修改, 邮件激活的所有路由 */</span>
<span class="nx">Auth</span><span class="o">::</span><span class="na">routes</span><span class="p">();</span>

<span class="cm">/* 这个一般没什么用, 因为我们已经有主页路由了 */</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeController@index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/*
</span><span class="cm">	我们将 Auth::routes(); 替换为如下功能是一样的
</span><span class="cm">*/</span>
<span class="c1">// 用户身份验证相关的路由
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\LoginController@showLoginForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\LoginController@login&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\LoginController@logout&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">);</span>

<span class="c1">// 用户注册相关路由
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\RegisterController@showRegistrationForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;register&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\RegisterController@register&#39;</span><span class="p">);</span>

<span class="c1">// 密码重置相关路由
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password/reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ForgotPasswordController@showLinkRequestForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.request&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;password/email&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ForgotPasswordController@sendResetLinkEmail&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.email&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password/reset/{token}&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ResetPasswordController@showResetForm&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.reset&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;password/reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\ResetPasswordController@reset&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;password.update&#39;</span><span class="p">);</span>

<span class="c1">// Email 认证相关路由
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;email/verify&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\VerificationController@show&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;verification.notice&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;email/verify/{id}/{hash}&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\VerificationController@verify&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;verification.verify&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;email/resend&#39;</span><span class="p">,</span> <span class="s1">&#39;Auth\VerificationController@resend&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;verification.resend&#39;</span><span class="p">);</span>

</code></pre></td></tr></table>
</div>
</div><h1 id="九-路由签名">九. 路由签名</h1>
<blockquote>
<p><a href="https://learnku.com/laravel/t/9404/laravel-56-new-function-routing-signature">路由签名</a></p>
<p>假设我们有一套让用户快速回复活动计划的应用程序，我们希望发送 email 让所有用户快速回复 “参加” 还是 “不参加”。然而我们并不希望强迫用户在程序已经退出登录的情况下需要重新登录才能作出回复。</p>
<p>即可以在不用登陆的情况下, 使用URL安全的发送带有用户身份的信息.</p>
</blockquote>
<p>路由签名实现分为两个步骤</p>
<ol>
<li>
<p><strong>URL生成 :</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 使用URL服务生成 */</span>
<span class="k">use</span> <span class="nx">\Illuminate\Support\Facades\URL</span><span class="p">;</span>

<span class="cm">/* 
</span><span class="cm">	便是生成的URL签名字段
</span><span class="cm">	Signature 是通过
</span><span class="cm">        1. event.rsvp 路由
</span><span class="cm">        2. id 25
</span><span class="cm">        3. user 100
</span><span class="cm">        4. response yes
</span><span class="cm">        5. 时间一个小时内 
</span><span class="cm">	这些信息加密得到的
</span><span class="cm">*/</span>
<span class="nv">$url</span> <span class="o">=</span> 
    <span class="nx">URL</span><span class="o">::</span><span class="na">temporarySignedRoute</span><span class="p">(</span><span class="s1">&#39;event.rsvp&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addHour</span><span class="p">(),</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span>
        <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;response&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yes&#39;</span>
    <span class="p">]);</span>

<span class="cm">/* 将此$url 返回给client */</span>
<span class="k">return</span> <span class="nv">$url</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>定义路由接受 :</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 
</span><span class="cm">	web.php 中定义路由接受验证生成的URL 
</span><span class="cm">*/</span>

<span class="cm">/* 
</span><span class="cm">	此时Http请求在被rsvp方法处理的时候, 会自动调用 signed 中间件对签名进行验证
</span><span class="cm">*/</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;event/{id}/rsvp/{user}/{response}&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s2">&#34;event.rsvp&#34;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;signed&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h1 id="十一-上传图片">十一. 上传图片</h1>
<p>前端部分需要在 form标签 属性中加入，否则上传的仅为图片名称</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html">enctype=&#34;multipart/form-data&#34;
</code></pre></td></tr></table>
</div>
</div><p>后台部分</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// 图片上传的工具类
</span><span class="c1">// 图片作为 web 中可以访问的资源，一般被放置到 /public/ 文件夹下
</span><span class="c1">// 且 url/ 访问的都是 public/下的资源，url/uploads/ 对应到服务器上即为 url/public/upoloads/ 因为其他文件对外部并不开放
</span><span class="c1"></span>
<span class="k">namespace</span> <span class="nx">App\Handlers</span><span class="p">;</span>
<span class="k">use</span>  <span class="nx">Illuminate\Support\Str</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ImageUploadHandler</span>
<span class="p">{</span>

    <span class="c1">// 只允许以下后缀名的图片文件上传
</span><span class="c1"></span>    <span class="k">protected</span> <span class="nv">$allowed_ext</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;png&#34;</span><span class="p">,</span> <span class="s2">&#34;jpg&#34;</span><span class="p">,</span> <span class="s2">&#34;gif&#34;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">];</span>
	
    <span class="c1">// save 函数对上传的图片进行简单的处理，且移动到指定的位置
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">save</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$folder</span><span class="p">,</span> <span class="nv">$file_prefix</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 构建存储的文件夹规则，值如：uploads/images/avatars/201709/21/
</span><span class="c1"></span>        <span class="c1">// 文件夹切割能让查找效率更高。
</span><span class="c1"></span>        <span class="nv">$folder_name</span> <span class="o">=</span> <span class="s2">&#34;uploads/images/</span><span class="si">$folder</span><span class="s2">/&#34;</span> <span class="o">.</span> <span class="nx">date</span><span class="p">(</span><span class="s2">&#34;Ym/d&#34;</span><span class="p">,</span> <span class="nx">time</span><span class="p">());</span>

        <span class="c1">// 文件具体存储的物理路径，`public_path()` 获取的是 `public` 文件夹的物理路径。
</span><span class="c1"></span>        <span class="c1">// 值如：/home/vagrant/Code/larabbs/public/uploads/images/avatars/201709/21/
</span><span class="c1"></span>        <span class="nv">$upload_path</span> <span class="o">=</span> <span class="nx">public_path</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$folder_name</span><span class="p">;</span>

        <span class="c1">// 获取文件的后缀名，因图片从剪贴板里黏贴时后缀名为空，所以此处确保后缀一直存在
</span><span class="c1"></span>        <span class="nv">$extension</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalExtension</span><span class="p">())</span> <span class="o">?:</span> <span class="s1">&#39;png&#39;</span><span class="p">;</span>

        <span class="c1">// 拼接文件名，加前缀是为了增加辨析度，前缀可以是相关数据模型的 ID
</span><span class="c1"></span>        <span class="c1">// 值如：1_1493521050_7BVc9v9ujP.png
</span><span class="c1"></span>        <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$file_prefix</span> <span class="o">.</span> <span class="s1">&#39;_&#39;</span> <span class="o">.</span> <span class="nx">time</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;_&#39;</span> <span class="o">.</span> <span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$extension</span><span class="p">;</span>

        <span class="c1">// 如果上传的不是图片将终止操作
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nx">in_array</span><span class="p">(</span><span class="nv">$extension</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">allowed_ext</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 将图片移动到我们的目标存储路径中
</span><span class="c1"></span>        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span><span class="nv">$upload_path</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">);</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;app.url&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;/</span><span class="si">$folder_name</span><span class="s2">/</span><span class="si">$filename</span><span class="s2">&#34;</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// 在对应的 controller 中既可以使用 IOC 的方式进行注入
</span><span class="c1"></span><span class="k">public</span> <span class="nx">fcuntion</span> <span class="nx">myFunc</span><span class="p">(</span><span class="nx">ImageUploadHandler</span> <span class="nv">$imageUploadHandler</span><span class="p">){</span>
    <span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="十二-缓存系统">十二. 缓存系统</h1>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/7.x/cache/7482#driver-prerequisites">缓存系统</a></p>
<p>Laravel 为各种后端缓存提供了丰富而统一的 API，其配置信息位于 <code>config/cache.php</code> 文件中。在该文件中你可以指定应用默认使用哪个缓存驱动。Laravel 支持当前流行的后端缓存，例如 <a href="https://memcached.org/">Memcached</a> 和 <a href="https://redis.io/">Redis</a> 。</p>
</blockquote>
<p>缓存系统的配置文件位于 <code>cache.php</code> 中。</p>
<h2 id="redis-驱动配置">Redis 驱动配置</h2>
<p>首先需要安装 redis 在 php 中提供的客户端如 <code>predis</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-.env" data-lang=".env"><span class="c1"># .env 配置文件中指定</span>

<span class="c1"># 缓存系统的 driver</span>
<span class="nv">CACHE_DRIVER</span><span class="o">=</span>redis
<span class="nv">REDIS_CLIENT</span><span class="o">=</span>predis
<span class="nv">REDIS_HOST</span><span class="o">=</span>127.0.0.1
<span class="nv">REDIS_PASSWORD</span><span class="o">=</span>null
<span class="nv">REDIS_PORT</span><span class="o">=</span><span class="m">6379</span>
</code></pre></td></tr></table>
</div>
</div><p>对于 redis 的配置文件写在 <code>database.php</code> 中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="s1">&#39;redis&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>

    <span class="s1">&#39;client&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;phpredis&#39;</span><span class="p">),</span>

    <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;cluster&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CLUSTER&#39;</span><span class="p">,</span> <span class="s1">&#39;redis&#39;</span><span class="p">),</span>
        <span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PREFIX&#39;</span><span class="p">,</span> <span class="nx">Str</span><span class="o">::</span><span class="na">slug</span><span class="p">(</span><span class="nx">env</span><span class="p">(</span><span class="s1">&#39;APP_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;laravel&#39;</span><span class="p">),</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;_database_&#39;</span><span class="p">),</span>
    <span class="p">],</span>
	
    
    <span class="cm">/* 一般用途的 redis 使用如下配置，如 redis 驱动的队列 */</span>
    <span class="cm">/* 默认使用 redis 的数据库0 */</span>
    <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_URL&#39;</span><span class="p">),</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
        <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="s1">&#39;6379&#39;</span><span class="p">),</span>
        <span class="s1">&#39;database&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_DB&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">),</span>
    <span class="p">],</span>
	
    <span class="cm">/* 缓存系统 的 redis 使用如下配置 */</span>
    <span class="cm">/* 默认使用 redis 的数据库1 */</span>
    <span class="s1">&#39;cache&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_URL&#39;</span><span class="p">),</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
        <span class="s1">&#39;port&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">,</span> <span class="s1">&#39;6379&#39;</span><span class="p">),</span>
        <span class="s1">&#39;database&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;REDIS_CACHE_DB&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">),</span>
    <span class="p">],</span>

<span class="p">],</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="缓存相关命令">缓存相关命令</h2>
<h3 id="清空所有缓存">清空所有缓存</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="nv">$php</span> artisan cache:clear
</code></pre></td></tr></table>
</div>
</div><h2 id="缓存的使用">缓存的使用</h2>
<blockquote>
<p><code>Illuminate\Contracts\Cache\Factory</code> 和 <code>Illuminate\Contracts\Cache\Repository</code> <a href="https://learnku.com/docs/laravel/7.x/contracts">契约</a> 提供了 Laravel 缓存服务的访问机制。 <code>Factory</code> 契约为你的应用程序定义了访问所有缓存驱动的机制。 <code>Repository</code> 契约通常是由你的 <code>cache</code> 配置文件指定的默认缓存驱动实现的。</p>
</blockquote>
<p>###存值 <code>put</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>

<span class="cm">/* 600 为过期时间，即为10分钟 */</span>
<span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Joel&#39;</span><span class="p">,</span> <span class="mi">600</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="取值-get">取值 <code>get</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>

<span class="cm">/* 取 key 为name的值 */</span>
<span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="获取值且不存在的时候设置-remember">获取值且不存在的时候设置 <code>remember</code></h3>
<p>有时你可能想从缓存中获取一个数据，而当请求的缓存项不存在时，程序能为你存储一个默认值你可以使用 <code>Cache::remember</code> 方法来实现：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/*
</span><span class="cm">例如，你可能想从缓存中获取所有用户，当缓存中不存在这些用户时，程序将从数据库将这些用户取出并放入缓存。
</span><span class="cm">*/</span>

<span class="c1">// user为获取的key值, $seconds 为过期时间, 后面的匿名函数即为不存在的时候设置的值
</span><span class="c1"></span><span class="nv">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">remember</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nv">$seconds</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// 当不传时间的时候，即为永久
</span><span class="c1"></span><span class="nv">$value</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">remember</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">LYR</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        0001-01-01
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        
        <a class="next" href="/post/10.%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/php/php-laravel/laravel-comprehensive-topic/">
            <span class="next-text nav-default"></span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:lyr-2000@qq.com" class="iconfont icon-email" title="email"></a>
  <a href="http://doc.lyr-2000.xyz/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>lyr</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>








</body>
</html>
