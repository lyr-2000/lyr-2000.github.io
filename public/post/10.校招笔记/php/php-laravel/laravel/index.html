<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title> - Even - A super concise theme for Hugo</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="LYR" /><meta name="description" content="[TOC] Laravel MVC Laravel 6 中文文档 Laravel项目入门实战 Route 层 路由层, 将 http 请求映射到相应的控制器中. 注意处理 http 路由的位于 routes/web.php 中 Laravel 遵从 RESTful 架构的设计原则，将数据" /><meta name="keywords" content="LYR的文档站, LYR的个人博客, even" />






<meta name="generator" content="Hugo 0.86.0 with theme even" />


<link rel="canonical" href="http://doc.lyr-2000.xyz/post/10.%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/php/php-laravel/laravel/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="" />
<meta property="og:description" content="[TOC] Laravel MVC Laravel 6 中文文档 Laravel项目入门实战 Route 层 路由层, 将 http 请求映射到相应的控制器中. 注意处理 http 路由的位于 routes/web.php 中 Laravel 遵从 RESTful 架构的设计原则，将数据" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://doc.lyr-2000.xyz/post/10.%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/php/php-laravel/laravel/" /><meta property="article:section" content="post" />



<meta itemprop="name" content="">
<meta itemprop="description" content="[TOC] Laravel MVC Laravel 6 中文文档 Laravel项目入门实战 Route 层 路由层, 将 http 请求映射到相应的控制器中. 注意处理 http 路由的位于 routes/web.php 中 Laravel 遵从 RESTful 架构的设计原则，将数据">

<meta itemprop="wordCount" content="4661">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="[TOC] Laravel MVC Laravel 6 中文文档 Laravel项目入门实战 Route 层 路由层, 将 http 请求映射到相应的控制器中. 注意处理 http 路由的位于 routes/web.php 中 Laravel 遵从 RESTful 架构的设计原则，将数据"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">LYR的文档站</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档页</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a><a href="/friends">
        <li class="mobile-menu-item">大佬</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">LYR的文档站</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/friends">大佬</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title"></h1>

      <div class="post-meta">
        <span class="post-time"> 0001-01-01 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#laravel-mvc">Laravel MVC</a></li>
    <li><a href="#route-层">Route 层</a>
      <ul>
        <li><a href="#get-方法映射">GET 方法映射</a>
          <ul>
            <li><a href="#调用-route-with-get-传参">调用 route with get 传参</a></li>
          </ul>
        </li>
        <li><a href="#delete-方法映射">DELETE 方法映射</a></li>
        <li><a href="#restful-接口全映射">RESTful 接口全映射</a></li>
      </ul>
    </li>
    <li><a href="#controller-控制器层">Controller 控制器层</a>
      <ul>
        <li><a href="#创建一个控制器">创建一个控制器</a></li>
        <li><a href="#控制器传递参">控制器传递参</a></li>
      </ul>
    </li>
    <li><a href="#数据库">数据库</a>
      <ul>
        <li><a href="#查询构造器">查询构造器</a>
          <ul>
            <li><a href="#原生查询">原生查询</a></li>
          </ul>
        </li>
        <li><a href="#数据库迁移">数据库迁移</a>
          <ul>
            <li><a href="#添加字段">添加字段</a></li>
            <li><a href="#新增数据表">新增数据表</a></li>
            <li><a href="#迁移回滚">迁移回滚</a></li>
          </ul>
        </li>
        <li><a href="#数据填充">数据填充</a>
          <ul>
            <li><a href="#填充初始数据">填充初始数据</a></li>
            <li><a href="#填充测试数据">填充测试数据</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#view-层">View 层</a>
      <ul>
        <li><a href="#view-层赋值">View 层赋值</a></li>
      </ul>
    </li>
    <li><a href="#model-层">Model 层</a>
      <ul>
        <li>
          <ul>
            <li><a href="#创建一个-model">创建一个 <code>Model</code></a></li>
            <li><a href="#attribute-字段访问"><code>Attribute</code> 字段访问</a></li>
            <li><a href="#fillable-成员变量"><code>fillable</code> 成员变量</a></li>
            <li><a href="#timestamps-成员变量"><code>timestamps</code> 成员变量</a></li>
            <li><a href="#getter--访问器"><code>getter</code>  访问器</a></li>
          </ul>
        </li>
        <li><a href="#模型操作-crud">模型操作 CRUD</a>
          <ul>
            <li><a href="#查询">查询</a></li>
            <li><a href="#save--新增--更新-数据"><code>save</code>  新增 &amp; 更新 数据</a></li>
            <li><a href="#create-创建--批量创建"><code>create</code> 创建 &amp; 批量创建</a></li>
          </ul>
        </li>
        <li><a href="#model-repl---tinker">Model REPL - tinker</a>
          <ul>
            <li><a href="#新增记录">新增记录</a></li>
          </ul>
        </li>
        <li><a href="#模型事件">模型事件</a>
          <ul>
            <li><a href="#利用-观察者模式为模型制定-event-逻辑">利用 观察者模式为模型制定 event 逻辑</a></li>
          </ul>
        </li>
        <li><a href="#模型关联">模型关联</a>
          <ul>
            <li><a href="#一对多逻辑-hasmany">一对多逻辑 hasMany</a></li>
            <li><a href="#多对一逻辑-belongsto">多对一逻辑 belongsTo</a></li>
            <li><a href="#多对多逻辑-belongstomany">多对多逻辑 belongsToMany</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>[TOC]</p>
<h1 id="laravel-mvc">Laravel MVC</h1>
<p><a href="https://learnku.com/docs/laravel/6.x">Laravel 6 中文文档 </a></p>
<p><a href="https://learnku.com/courses/laravel-essential-training/6.x">Laravel项目入门实战</a></p>
<h1 id="route-层">Route 层</h1>
<p>路由层, 将 http 请求映射到相应的控制器中. 注意处理 http 路由的位于 <code>routes/web.php</code> 中</p>
<blockquote>
<p>Laravel 遵从 RESTful 架构的设计原则，将数据看做一个资源，由 URI 来指定资源。对资源进行的获取、创建、修改和删除操作，分别对应 HTTP 协议提供的 GET、POST、PATCH 和 DELETE 方法</p>
</blockquote>
<h2 id="get-方法映射">GET 方法映射</h2>
<p>在路由映射中, 我们同样利用 RESTful 设计接口, 例如:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// 接受 浏览器端发来的 get 请求, 路由为 &#39;/&#39; 映射到  StaticPagesController 控制器下的 home 方法
</span><span class="c1"></span><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;StaticPagesController@home&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/help&#39;</span><span class="p">,</span> <span class="s1">&#39;StaticPagesController@help&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;help&#39;</span><span class="p">);</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/about&#39;</span><span class="p">,</span> <span class="s1">&#39;StaticPagesController@about&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;about&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="调用-route-with-get-传参">调用 route with get 传参</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1"># [$user] 为这个 GET 请求的传参时, 会默认获得这个模型的主键作为传参
</span><span class="c1"></span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;users.show&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$user</span><span class="p">])</span>
    
<span class="c1"># 等效于 
</span><span class="c1"></span>    
<span class="nx">route</span><span class="p">(</span><span class="s1">&#39;users.show&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="delete-方法映射">DELETE 方法映射</h2>
<p>delete 在 RESTful 设计中表示删除一个资源. 可以用于 <strong>删除用户, 登出</strong> 等功能</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Route</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span><span class="s1">&#39;SessionsController@delete&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>在 delete 对应的 controller 中, 不直接返回 View, 而是在实现逻辑后采用重定向的功能.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(){</span>
    <span class="o">...</span>
        
	<span class="c1">// 完成逻辑后重定向到 login 路由
</span><span class="c1"></span>	<span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>注意在前端, 我们浏览器现在还不支持发送 <code>delete</code>请求, 所以在前端 from 中我们需要增加隐藏域表示 delete 方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;{{ route(&#39;logout&#39;) }}&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;POST&#34;</span><span class="p">&gt;</span>
    {{ csrf_field() }}
    {{--   可以模拟出浏览器发出 delete 请求  --}}
    {{ method_field(&#39;DELETE&#39;) }}
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-block btn-danger&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;button&#34;</span><span class="p">&gt;</span>退出<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="restful-接口全映射">RESTful 接口全映射</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">-</span> <span class="mf">1.</span> <span class="nx">定义一个</span> <span class="nx">RESTful</span> <span class="nx">接口</span>

    <span class="c1">// users 为资源名, 后一个为控制器名
</span><span class="c1"></span>    <span class="nx">Route</span><span class="o">::</span><span class="na">resource</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController&#39;</span><span class="p">);</span>

    <span class="c1">// 以上代码等同于下面所有操作 
</span><span class="c1"></span>
    <span class="c1">// 获得所有用户
</span><span class="c1"></span>    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController@index&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;users.index&#39;</span><span class="p">);</span>
    <span class="c1">// 获得 创建一个用户的页面
</span><span class="c1"></span>    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users/create&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController@create&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;users.create&#39;</span><span class="p">);</span>
    <span class="c1">// 根据用户id展现一个用户
</span><span class="c1"></span>    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users/{user}&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController@show&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;users.show&#39;</span><span class="p">);</span>
    <span class="c1">// post 方法创建一个用户
</span><span class="c1"></span>    <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController@store&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;users.store&#39;</span><span class="p">);</span>
    <span class="c1">// 获得更新用户信息页面
</span><span class="c1"></span>    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/users/{user}/edit&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController@edit&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;users.edit&#39;</span><span class="p">);</span>
    <span class="c1">// 更新用户操作
</span><span class="c1"></span>    <span class="nx">Route</span><span class="o">::</span><span class="na">patch</span><span class="p">(</span><span class="s1">&#39;/users/{user}&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController@update&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;users.update&#39;</span><span class="p">);</span>
    <span class="c1">// 删除用户操作
</span><span class="c1"></span>    <span class="nx">Route</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;/users/{user}&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController@destroy&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;users.destroy&#39;</span><span class="p">);</span>



<span class="o">-</span> <span class="mf">2.</span> <span class="nx">定义一个</span> <span class="nx">RESTful</span> <span class="nx">接口的同时指定特定操作</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">resource</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="s1">&#39;UsersController&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;only&#39;</span><span class="o">=&gt;</span><span class="p">[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;destory&#39;</span><span class="p">]]);</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="controller-控制器层">Controller 控制器层</h1>
<h2 id="创建一个控制器">创建一个控制器</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 创建一个 UsersController 的控制器</span>
<span class="nv">$php</span> artisan make:controller UsersController
</code></pre></td></tr></table>
</div>
</div><h2 id="控制器传递参">控制器传递参</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* ----------- 1. Request 对象获得 ----------- */</span>

<span class="cm">/*
</span><span class="cm">	最普通获得前端的数据的方法通过 request
</span><span class="cm">	可以获得 get , post 数据
</span><span class="cm">*/</span>  
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&#34;/show/{id}&#34;</span><span class="p">,</span> <span class="s2">&#34;User@show&#34;</span><span class="p">);</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">){</span>
    <span class="cm">/* 传递request对象 从而获得id */</span>
    <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* ----------- 2. 直接封装为 Eloquent 模型 ----------- */</span>
<span class="cm">/*
</span><span class="cm">	当传递的 id 为某个模型的 主键的时候, 那么 laravel 在传递的时候
</span><span class="cm">	可以自定根据id封装为 Eloquent 模型
</span><span class="cm">*/</span>  

<span class="cm">/* 使用此种方法的时候, {user} 名称必须和 Eloquent模型名相同, 同时首字母小写 */</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">&#34;/show/{user}&#34;</span><span class="p">,</span> <span class="s2">&#34;User@show&#34;</span><span class="p">);</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">){</span>
    <span class="cm">/* 直接获得 Eloquent 模型 */</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="数据库">数据库</h1>
<h2 id="查询构造器">查询构造器</h2>
<p><code>laravel</code> 中可以直接使用 <code>Illuminate\Support\Facades\DB;</code>  的外观类构造 sql 查询</p>
<h3 id="原生查询">原生查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1"># 查询可以直接通过 DB::select() 函数构建.
</span><span class="c1"># ？即为占位符，用于做变量替换
</span><span class="c1"></span><span class="k">return</span> <span class="nx">DB</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s2">&#34;SELECT * from post where u_id = ? limit ?&#34;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">]);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="数据库迁移">数据库迁移</h2>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/6.x/migrations/5173">手册中的数据库迁移</a></p>
</blockquote>
<p>数据库迁移在团队开发中很重要, 可以选择直接利用 sql 文件, 或者<code>Laravel</code> 中采用 <code>migrate</code> 的方式进行数据库迁移 (仅仅迁移表结构)</p>
<p><code>Migrate</code> 文件位于 <code>\databases\migrations</code> 下. 初始状态下, <code>Laravel</code> 提供了三个表的表结构, 如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">database/migrations/2019_08_19_000000_create_users_table.php
database/migrations/2019_08_19_100000_create_password_resets_table.php
database/migrations/2019_08_19_000000_create_failed_jobs_table.php
</code></pre></td></tr></table>
</div>
</div><p><code>Migrate </code>相关的命令操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">- <span class="m">1</span> . 根据数据库迁移文件完成的数据库创建
&gt; php artisan migrate 

- 2. 修改某些迁移文件后, 重新根据种子去刷新数据库
&gt; php artisan migrate:refresh --seed
</code></pre></td></tr></table>
</div>
</div><h3 id="添加字段">添加字段</h3>
<p>假设我们需要给已经生成的表 <code>users</code> 添加字段 <code>is_admin</code>, 步骤如下 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// ------- 1. 生成一个 migrate 文件
</span><span class="c1"></span><span class="o">&gt;</span> <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">add_user_is_admin</span> <span class="o">--</span><span class="nx">table</span><span class="o">=</span><span class="nx">users</span>

<span class="c1">// ------- 2. 编辑该迁移文件的 up, down 函数, 分别对应执行和回滚
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">boolean</span><span class="p">(</span><span class="s1">&#39;is_admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">default</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
        <span class="p">});</span>	
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//
</span><span class="c1"></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">dropColumn</span><span class="p">(</span><span class="s1">&#39;is_admin&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>

<span class="c1">// ------ 3. 执行该文件
</span><span class="c1"></span><span class="o">&gt;</span> <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">migrate</span>
</code></pre></td></tr></table>
</div>
</div><p>添加字段的默认选择:</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>default()</td>
<td>定义该字段的默认值</td>
</tr>
<tr>
<td>nullable()</td>
<td>表示该字段可以为空</td>
</tr>
</tbody>
</table>
<h3 id="新增数据表">新增数据表</h3>
<p>在数据库层面添加数据表, 例如添加 blogs 步骤如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1"># 1. 生成一个 create_table_blogs 的迁移文件
</span><span class="c1"></span><span class="o">&gt;</span> <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">migration</span> <span class="nx">create_table_blogs</span> <span class="o">--</span><span class="nx">create</span><span class="o">=</span><span class="s2">&#34;blogs&#34;</span>


<span class="c1"># 2. 在 create_table_blogs 中定义字段
</span><span class="c1"></span>    <span class="nx">在默认的create_table_blogs文件中</span><span class="p">,</span> <span class="nx">laravel</span> <span class="nx">会为数据表自动创建如下字段</span> <span class="o">:</span>
	<span class="nx">id</span> <span class="o">|</span> <span class="nx">create_at</span> <span class="o">|</span> <span class="nx">update_at</span> <span class="nx">三个字段</span><span class="p">,</span> <span class="nx">对应的以下代码</span><span class="o">:</span>

	<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">bigIncrements</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
	<span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>

<span class="c1"># 3. 运行迁移文件
</span><span class="c1"></span><span class="o">&gt;</span> <span class="nx">php</span> <span class="nx">artisan</span><span class="o">:</span><span class="nx">migrate</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="迁移回滚">迁移回滚</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># laravel 的回滚有如下方式</span>

<span class="c1"># 回滚最近一次迁移命令</span>
&gt;<span class="nv">$php</span> artisan migrate:rollback

<span class="c1"># 回滚指定次数的迁移</span>
&gt;<span class="nv">$php</span> artisan migrate:rollback --setp<span class="o">=</span><span class="m">5</span>

<span class="c1"># 回滚所有的迁移</span>
&gt;<span class="nv">$php</span> artisan migrate:reset

<span class="c1"># 回滚后再执行所有的迁移</span>
&gt;<span class="nv">$php</span> artisan migrate:refresh
</code></pre></td></tr></table>
</div>
</div><h2 id="数据填充">数据填充</h2>
<h3 id="填充初始数据">填充初始数据</h3>
<p>有一些数据需要在数据表形成的时候，便需要填充一些初始化数据，我们使用 <code>laravel</code> 中的迁移文件即可实现.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1">// 例如在初始的时候，便需要给给 postCategories 表插入如下数据
</span><span class="c1"></span>
<span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">SeedPostCategoriesData</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**
</span><span class="sd">     * Run the migrations.
</span><span class="sd">     *
</span><span class="sd">     * @return void
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//
</span><span class="c1"></span>        <span class="nv">$initCategories</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s1">&#39;name&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;分享&#39;</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;分享创造，分享发现&#39;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="s1">&#39;name&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;教程&#39;</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;开发技巧、推荐扩展包等&#39;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="s1">&#39;name&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;问答&#39;</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;请保持友善，互帮互助&#39;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="s1">&#39;name&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;公告&#39;</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;站点公告&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">];</span>

        <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;postCategories&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="nv">$initCategories</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
</span><span class="sd">     * Reverse the migrations.
</span><span class="sd">     *
</span><span class="sd">     * @return void
</span><span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// truncate() 方法为清空 categories 数据表里的所有数据。
</span><span class="c1"></span>        <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;postCategories&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">truncate</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="填充测试数据">填充测试数据</h3>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/6.x/seeding/5174">手册中的数据填充</a></p>
</blockquote>
<p>就是利用假数据填充数据库做测试, 我们利用 Faker 库自动数据填充例子如下 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">假设需要给</span> <span class="nx">blogs</span> <span class="nx">数据表自动填充数据</span>

<span class="o">|</span> <span class="nx">id</span> <span class="o">|</span> <span class="nx">user_id</span>  <span class="o">|</span><span class="nx">content</span> <span class="o">|</span> <span class="nx">updated_at</span> <span class="o">|</span> <span class="nx">created_at</span> <span class="o">|</span>

<span class="o">-</span> <span class="mf">1.</span> <span class="nx">创建一个</span> <span class="nx">factory</span> <span class="nx">工厂</span> <span class="o">=&gt;</span> <span class="nx">BlogFactory</span><span class="o">.</span><span class="nx">php</span> <span class="nx">手动创建或者命令行均可</span> <span class="o">:</span> 
  <span class="o">&gt;</span> <span class="nv">$php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">factory</span> <span class="nx">BlogFactory</span> <span class="o">--</span><span class="nx">model</span><span class="o">=</span><span class="s2">&#34;Blog&#34;</span>
    
<span class="o">-</span> <span class="mi">2</span> <span class="o">.</span> <span class="nx">编辑</span> <span class="nx">工厂文件</span><span class="p">,</span> <span class="nx">定义</span> <span class="nx">faker</span> <span class="nx">数据生成规则</span>
  <span class="nv">$factory</span><span class="o">-&gt;</span><span class="na">define</span><span class="p">(</span><span class="nx">Blog</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Faker</span> <span class="nv">$faker</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$date_time</span> <span class="o">=</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="na">date</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="na">time</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
            <span class="s1">&#39;created_at&#39;</span> <span class="o">=&gt;</span> <span class="nv">$date_time</span><span class="p">,</span>
            <span class="s1">&#39;updated_at&#39;</span> <span class="o">=&gt;</span> <span class="nv">$date_time</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">});</span>


<span class="o">-</span> <span class="mf">3.</span> <span class="nx">生成一个</span> <span class="nx">seeder</span> <span class="p">,</span> <span class="nx">并且和该工厂对应</span>
    <span class="o">&gt;</span> <span class="err">$</span> <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">seeder</span> <span class="nx">BlogTableSeeder</span>
    
     
<span class="o">-</span> <span class="mf">4.</span> <span class="nx">编辑</span> <span class="nx">BlogTableSeeder</span><span class="o">.</span><span class="nx">php</span> <span class="nx">文件的</span> <span class="nx">run</span> <span class="nx">方法</span>
	<span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>	
        <span class="c1">// 生成 50 条数据
</span><span class="c1"></span>        <span class="nv">$blogs</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">Blog</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">times</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">make</span><span class="p">();</span>
        <span class="nx">Blog</span><span class="o">::</span><span class="na">insert</span><span class="p">(</span><span class="nv">$blogs</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">());</span>
    <span class="p">}</span>
	
<span class="o">-</span> <span class="mf">5.</span> <span class="nx">运行</span> <span class="nx">seeder</span>
    
    <span class="o">&gt;</span> <span class="nv">$php</span> <span class="nx">artisan</span> <span class="nx">db</span><span class="o">:</span><span class="nx">seed</span> <span class="o">--</span><span class="nx">class</span><span class="o">=</span><span class="nx">BlogTableSeeder</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="view-层">View 层</h1>
<p>Webapp 中 View 层即传递给前端的 HTML</p>
<h2 id="view-层赋值">View 层赋值</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1"># 返回在 user/edit 的试图
</span><span class="c1"># 给页面传递参数的时候, 必须为数组形式, 也就是说 $data 必须为数组
</span><span class="c1"></span><span class="k">return</span> <span class="nx">View</span><span class="p">(</span><span class="s1">&#39;user.edit&#39;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span>
    
<span class="nv">$user</span><span class="p">;</span>  
<span class="c1"># 当传参不为数组的时候, 我们可以用 compact 函数将其转化为数组
</span><span class="c1"></span><span class="k">return</span> <span class="nx">View</span><span class="p">(</span><span class="s1">&#39;user.edit&#39;</span><span class="p">,</span> <span class="nx">compact</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="model-层">Model 层</h1>
<p>##Eloquent ORM</p>
<p>Laravel 的 model 层为 ORM 架构, 在框架中叫 : <code>Eloquent ORM</code>, 所谓的 ORM 即为 Object Relation Map. 表示数据库中的每一个表都对应一个 Model 对象</p>
<p>表和model对象的对应关系为 : users表 -&gt; App\Models\User</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 继承 Model的User Eloquent */</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
  <span class="c1">// ...   
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="创建一个-model">创建一个 <code>Model</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 新增一个 Model</span>
$ php artisan make:model Models/Blog 
</code></pre></td></tr></table>
</div>
</div><h3 id="attribute-字段访问"><code>Attribute</code> 字段访问</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 
</span><span class="cm">	模型对象中将所有访问的字段存储在其的 Attribute 成员数组中
</span><span class="cm">*/</span>

<span class="c1"># 使用成员变量的形式访问
</span><span class="c1"></span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span> 

<span class="c1"># 实际上就是获得其 attribute[&#39;name&#39;];
</span><span class="c1"></span>    
<span class="c1"># 注意并不能直接在 Model 外部用这种方式访问，因为 attribute 为 protected 变量，并不能被访问到
</span><span class="c1"></span><span class="nx">❌</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">attribute</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 事实上，在 $user-&gt;name 的方式中，Model类会调用魔术方法 __get() */</span>

<span class="sd">/**
</span><span class="sd">     * Dynamically retrieve attributes on the model.
</span><span class="sd">     *
</span><span class="sd">     * @param  string  $key
</span><span class="sd">     * @return mixed
</span><span class="sd">*/</span>
<span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="fillable-成员变量"><code>fillable</code> 成员变量</h3>
<p>在 <code>created</code> 新增记录的时候, 需要注意在 <code>Model</code>内部指出, 哪些是可以被更新的. 即规定 <code>fillable</code> 变量. 否则会导致插入失败.</p>
<p>通俗来说 <code>$fillable</code> 变量规定了从数组转化为<code>eloquent</code> 实例的字段，只有其定义的字段才能被转化为 <code>eloquent</code> 实例的属性。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">Blog</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
	
    <span class="c1">// 指定模型中 content 字段为 fillable 字段. 从而可以正常插入
</span><span class="c1"></span>    <span class="c1">// $fillable 可以保护必要的字段不被更新
</span><span class="c1"></span>    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;content&#39;</span><span class="p">,</span>
    <span class="p">];</span>
    
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="timestamps-成员变量"><code>timestamps</code> 成员变量</h3>
<p>有些数据表不需要维护默认的 <code>timestamps</code> 字段，此时需要在对应的 model 中将其关闭</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">PostCategory</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="c1">// 不需要维护时间字段
</span><span class="c1"></span>    <span class="k">public</span> <span class="nv">$timestamps</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="getter--访问器"><code>getter</code>  访问器</h3>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/7.x/eloquent-mutators/7502#defining-an-accessor">Laravel 访问器</a></p>
</blockquote>
<p>访问器可以修改模型中某些字段的展示形式，例如对于数据库中的日期字段，我们可以使用 getter 对其进行更友好展现的修改.
创建一个访问器需要遵循一定的命名规则，例如:
<code>first_name =&gt; getFirstNameAttribute();</code>
<code>updated_at =&gt; getUpdatedAtAttribute();</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 以日期显示为例: */</span>
<span class="k">public</span> <span class="nx">Post</span> <span class="k">extends</span> <span class="nx">Model</span><span class="p">{</span>
	
<span class="c1">// ...
</span><span class="c1"></span>    
<span class="cm">/* 
</span><span class="cm">	updated_at 修改器 
</span><span class="cm">	将字符串形式的时间信息修改为更加人类有好的形式
</span><span class="cm">*/</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">getUpdatedAtAttribute</span><span class="p">(){</span>
	
    <span class="cm">/* 只有在 Model 内部才能使用 attributes[&#39;&#39;] 的形式访问，因为其为 protected */</span>
    <span class="k">return</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">parse</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">[</span><span class="s1">&#39;updated_at&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">diffForHumans</span><span class="p">();</span>

<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 
</span><span class="cm">	访问器会直接修改对应字段在 Attribute 数组中的值
</span><span class="cm">	
</span><span class="cm">	所以直接用属性的形式调用即可获得被 getter 处理后的值
</span><span class="cm">*/</span>
<span class="nv">$post</span><span class="o">-&gt;</span><span class="na">updated_at</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 
</span><span class="cm">	如果想访问原始值
</span><span class="cm">	在 Model 类中还有一个数组 original 存储所有的原始值
</span><span class="cm">*/</span>

<span class="k">public</span> <span class="nx">Post</span> <span class="k">extends</span> <span class="nx">Model</span><span class="p">{</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOrig</span><span class="p">(){</span>
        
        <span class="cm">/* 返回 protected 变量 */</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">original</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="模型操作-crud">模型操作 CRUD</h2>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/6.x/eloquent/5176#retrieving-single-models">快速入门</a></p>
</blockquote>
<h3 id="查询">查询</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* ------------------------ 1. find() ------------------- */</span>
<span class="cm">/* 
</span><span class="cm">	find() 函数默认查询的是表中的主键
</span><span class="cm">*/</span>
<span class="c1">// 返回表中 id = 1 的记录映射为 Eloquent 对象
</span><span class="c1"></span><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="cm">/* -------------------- 2. where() + first() ------------------- */</span>

<span class="c1">// 当查找项不在主键时候, 我们便需要使用 where + first 的方法查找第一个满足的记录
</span><span class="c1">// 凡事不利用主键, 那么都有可能返回超过1条记录, 所以要使用 first().
</span><span class="c1"></span><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;fz&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span>

<span class="c1">// 返回所有姓名为 fz 的记录, 并且封装为 collection
</span><span class="c1"></span><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;fz&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
   
</code></pre></td></tr></table>
</div>
</div><h3 id="save--新增--更新-数据"><code>save</code>  新增 &amp; 更新 数据</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* 
</span><span class="cm">	save
</span><span class="cm">	1. 是根据 Eloquent 实例来进行 数据新增和更新操作的
</span><span class="cm">	2. 自动维护 created_at, updated_at 两个字段
</span><span class="cm">*/</span>


<span class="c1">//	新增
</span><span class="c1"></span><span class="nv">$post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App\Models\Post</span><span class="p">();</span>
<span class="nv">$post</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span>
<span class="nv">$post</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="c1">// 更新
</span><span class="c1"></span><span class="nv">$post</span> <span class="o">=</span> <span class="nx">App\Models\Post</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span>
<span class="nv">$post</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;hello world&#39;</span><span class="p">;</span>
<span class="nv">$post</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="create-创建--批量创建"><code>create</code> 创建 &amp; 批量创建</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/*
</span><span class="cm">	create
</span><span class="cm">	1. create 使用过 Eloquent 类的静态方法来执行更新操作
</span><span class="cm">	2. create 的传递参数为一个 array 而不是 Eloquent 实例
</span><span class="cm">	3. 自动维护 created_at, updated_at 两个字段
</span><span class="cm">*/</span>

<span class="cm">/*
</span><span class="cm">	创建
</span><span class="cm">	注意使用create的时候，需要考虑Eloquent中定义的 fillable 变量的问题，
</span><span class="cm">	即传入的数组还会经过 fillable 的转化，如果 key 值不在 fillable 中定义的	话，数组中的改字段会被自动忽略。
</span><span class="cm">*/</span>
<span class="nx">App\Models\Post</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;title&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;hello&#39;</span><span class="p">]);</span>


<span class="cm">/*
</span><span class="cm">  批量创建
</span><span class="cm">  只需要在 create 方法中传入对应的数组即可。
</span><span class="cm">*/</span>
<span class="nx">App\Models\Post</span><span class="o">::</span><span class="na">create</span><span class="p">([[</span><span class="s1">&#39;title&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;hello&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;hello world&#39;</span><span class="p">]]);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="model-repl---tinker">Model REPL - tinker</h2>
<p>即直接用命令的方式进行数据库操作.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 进入 tinker 模式</span>
&gt; php artisan tinker

&gt;&gt;&gt; ...
</code></pre></td></tr></table>
</div>
</div><h3 id="新增记录">新增记录</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># App\Models\User 表示操作的模型</span>
&gt;&gt;&gt;App<span class="se">\M</span>odels<span class="se">\U</span>ser::create<span class="o">([</span><span class="s1">&#39;name&#39;</span><span class="o">=</span>&gt;<span class="s1">&#39;ark&#39;</span>,<span class="s1">&#39;email&#39;</span><span class="o">=</span>&gt;<span class="s1">&#39;ark@example.com&#39;</span>,<span class="s1">&#39;password&#39;</span><span class="o">=</span>&gt;bcrypt<span class="o">(</span><span class="s1">&#39;password&#39;</span><span class="o">)])</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="模型事件">模型事件</h2>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/6.x/eloquent/5176#events">手册中的模型事件</a></p>
</blockquote>
<p>Eloquent 模型事件允许我们在模型的合个生命周期节点上进行自定义操作. 模型的生命周期指的是 <strong>该条记录的生命周期而不是模型实例的生命周期</strong> , 比如 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">- retrieved : 当利用该模型从数据库中查找数据时触发
  for example : \App\Models\User::find(1);

- creating  : 当调用模型的 create 方法创建一个记录 **之前**.
  for example : 
  $user = User::create([
        &#39;name&#39; =&gt; $request-&gt;name,
        &#39;email&#39; =&gt; $request-&gt;email,
        &#39;password&#39; =&gt; bcrypt($request-&gt;password),
    ]);

- created  : 当调用模型的 create 方法创建一条记录 **之后**.

- updating : 当调用模型的 update 方法更新一条数据 **之前**

- updated  : 当调用模型的 update 方法更新一条数据 **之后**

- ...
</code></pre></td></tr></table>
</div>
</div><h3 id="利用-观察者模式为模型制定-event-逻辑">利用 观察者模式为模型制定 event 逻辑</h3>
<p>如果我们想为 <code>User</code> 模型 制定一个 <code>creating</code> 事件逻辑, 步骤如下 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">-</span> <span class="c1">// ----------- step 1 : 
</span><span class="c1"></span>  <span class="nx">利用artisan创建一个UserObserver</span> 
  <span class="o">&gt;</span> <span class="nx">php</span> <span class="nx">artisan</span> <span class="nx">make</span><span class="o">:</span><span class="nx">observer</span> <span class="nx">UserObserver</span> <span class="o">--</span><span class="nx">model</span><span class="o">=</span><span class="nx">User</span>
  
  
<span class="o">-</span> <span class="c1">// ----------- step 2 : 
</span><span class="c1"></span>  <span class="nx">在</span> <span class="nx">UserOberver</span> <span class="nx">中制定相应逻辑</span> 
  
  <span class="k">class</span> <span class="nc">UserObserver</span><span class="p">{</span>
      
      <span class="k">public</span> <span class="k">function</span> <span class="nf">creating</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">){</span>
          
          <span class="nx">Log</span><span class="o">::</span><span class="na">debug</span><span class="p">(</span><span class="s2">&#34;creating event happened&#34;</span><span class="p">);</span>
          
      <span class="p">}</span>
      
  <span class="p">}</span>
  
<span class="o">-</span> <span class="c1">// ----------- step 3 : 
</span><span class="c1"></span>  <span class="nx">在</span> <span class="nx">\App\Providers\AppServiceProvider</span> <span class="nx">的</span> <span class="nx">boot</span> <span class="nx">方法中将两者绑定</span>
  
    <span class="k">class</span> <span class="nc">AppServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
	<span class="p">{</span>
    
    <span class="c1">// ....
</span><span class="c1"></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="c1">// 绑定模型和观察者
</span><span class="c1"></span>                <span class="nx">User</span><span class="o">::</span><span class="na">observe</span><span class="p">(</span><span class="nx">UserObserver</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
            <span class="p">}</span>
	<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="模型关联">模型关联</h2>
<blockquote>
<p><a href="https://learnku.com/docs/laravel/5.5/eloquent-relationships/1333">手册中的模型关联</a></p>
<p><a href="https://learnku.com/laravel/t/15620/laravel-eloquent-model-associated-quick-lookup-table">模型关联详解</a></p>
</blockquote>
<p>即可以在 Model 层面对几个模型进行关联操作, 从而简化数据库逻辑.</p>
<h3 id="一对多逻辑-hasmany">一对多逻辑 hasMany</h3>
<p>比如一个用户会发多个微博. 可以如下处理:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">User</span> <span class="nx">extend</span> <span class="nx">Model</span><span class="p">{</span>
    
    <span class="c1">// ... code
</span><span class="c1"></span>    
    
    <span class="cm">/* 动态绑定 */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">blogs</span><span class="p">(){</span>
        
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="nx">\App\Models\Blog</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在调用的时候, 便可以直接利用:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1"># 获得该用户的所有博客
</span><span class="c1"></span><span class="o">&gt;&gt;&gt;</span> <span class="nx">\App\Models\User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">blogs</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="多对一逻辑-belongsto">多对一逻辑 belongsTo</h3>
<p>同样多个微博可以属于一个用户, 那么处理如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">Blog</span> <span class="nx">extend</span> <span class="nx">Model</span><span class="p">{</span>
    
    <span class="c1">// ... code
</span><span class="c1"></span>    
    
    <span class="cm">/* 动态绑定 */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">user</span><span class="p">(){</span>
        
        <span class="c1"># 默认情况下, blogs 表中的外键为 user_id, 如果不是需要在函数的第二个参数指定
</span><span class="c1"></span>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">\App\Models\User</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="c1">// return $this-&gt;belongsTo(\App\Models\User::class, &#39;foreignKey&#39;);
</span><span class="c1"></span>        
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在调用的时候, 便可以直接利用:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="c1"># 获得该博客的所属用户
</span><span class="c1"></span><span class="o">&gt;&gt;&gt;</span> <span class="nx">\App\Models\Blog</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="多对多逻辑-belongstomany">多对多逻辑 belongsToMany</h3>
<p>比如公交车和司机的关系, 一辆公交车可以有多个司机, 一个司机也可以驾驶多个公交车</p>
<img src='img/car_driver.png' width="300px"/>
<p>此时我们便可以利用 belongsToMany 关系</p>
<p>在模型文件中如下定义 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">Car</span> <span class="nx">extend</span> <span class="nx">Model</span><span class="p">{</span>
    
    <span class="c1">// ...
</span><span class="c1"></span>    
    <span class="k">public</span> <span class="k">class</span> <span class="nc">driver</span><span class="p">(){</span>
        
       <span class="c1">// car_driver 为中间表
</span><span class="c1"></span>       <span class="c1">// driver_id, car_id 都是中间表的字段
</span><span class="c1"></span>       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="nx">Driver</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;car_driver&#39;</span><span class="p">,</span><span class="s1">&#39;driver_id&#39;</span><span class="p">,</span> <span class="s1">&#39;car_id&#39;</span><span class="p">);</span>
        
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Driver</span> <span class="nx">extend</span> <span class="nx">Model</span><span class="p">{</span>
    
    <span class="c1">// ...
</span><span class="c1"></span>    
    <span class="k">public</span> <span class="k">class</span> <span class="nc">car</span><span class="p">(){</span>
        
       <span class="c1">// car_driver 为中间表
</span><span class="c1"></span>       <span class="c1">// driver_id, car_id 都是中间表的字段
</span><span class="c1"></span>       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="nx">Car</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;car_driver&#39;</span><span class="p">,</span> <span class="s1">&#39;car_id&#39;</span><span class="p">,</span> <span class="s1">&#39;driver_id&#39;</span><span class="p">);</span>
        
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>同时我们需要创建一个中间表 <code>car_driver</code> 当然也可以自定义其他的名字</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;car_driver&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">bigIncrements</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;car_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">();</span>
    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;driver_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">();</span>
    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><p>在定义好如上规则之后, 我们便可如下查值 :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 获得司机驾驶过的所有车辆信息</span>
&gt; <span class="nv">$driver</span>-&gt;car<span class="o">()</span>-&gt;get<span class="o">()</span>

<span class="c1"># 获得车辆的所有司机信息</span>
&gt; <span class="nv">$car</span>-&gt;driver<span class="o">()</span>-&gt;get<span class="o">()</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Laravel 内置的关于多对多的关联操作 :</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="cm">/* Laravel 内置了关于中间表(如 car_driver) 的相关关联操作, 所有的操作都是在中间表中进行改变, 而不改变主表*/</span>

<span class="o">-</span> <span class="mf">1.</span> <span class="nx">attach</span> <span class="nx">操作</span> <span class="p">(</span><span class="nx">简单添加</span><span class="p">)</span>
	<span class="cm">/* 将id 为1,2 的车辆标记为当前 driver 的历史驾驶车辆 */</span>
	<span class="nv">$driver</span><span class="o">-&gt;</span><span class="na">car</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
    
    <span class="cm">/* 将id 为2,3 的司机标记为当前车辆的 历史驾驶司机 */</span>
	<span class="nv">$car</span><span class="o">-&gt;</span><span class="na">driver</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="o">-</span> <span class="mf">2.</span> <span class="nx">sync</span> <span class="nx">操作</span> <span class="p">(</span><span class="nx">去重添加</span><span class="p">)</span>
    <span class="cm">/* 
</span><span class="cm">    	使用 attach 可能会出现重复添加的情况 for exmaple :
</span><span class="cm">    	$driver-&gt;car()-&gt;attach([1, 2, 1])
</span><span class="cm">    	那么 car_id 1 会重复添加到 car_driver 表中
</span><span class="cm">    	此时我们使用 sync 解决这个问题
</span><span class="cm">    */</span>
    <span class="nv">$driver</span><span class="o">-&gt;</span><span class="na">car</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">sync</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="k">false</span><span class="p">);</span>
    
<span class="o">-</span> <span class="mf">3.</span> <span class="nx">detach</span> <span class="p">(</span><span class="nx">删除</span><span class="p">)</span>
    <span class="cm">/* 删除当前司机的 car_id 为 1,2 的中间表记录 */</span>
    <span class="nv">$driver</span><span class="o">-&gt;</span><span class="na">car</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">LYR</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        0001-01-01
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/10.%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/php/php-laravel/laravel-sys-function/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default"></span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:lyr-2000@qq.com" class="iconfont icon-email" title="email"></a>
  <a href="http://doc.lyr-2000.xyz/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>lyr</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script type="text/javascript" async src="/lib/mathjax/es5/tex-mml-chtml.js"></script>








</body>
</html>
