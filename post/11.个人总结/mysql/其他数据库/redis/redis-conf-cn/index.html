<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>redis conf 配置 - 凌冬的个人博客</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="LYR" /><meta name="description" content="以下为redis.conf的文件的中文描述，整理于网络 1 2 3 4 5 6 7 8 9 10 11 12 # Redis 配置文件示例 # 注意单位: 当需要配置内存大小时, 可能需要指定" /><meta name="keywords" content="凌冬的博客, LYR的个人博客, even" />






<meta name="generator" content="Hugo 0.74.2 with theme even" />


<link rel="canonical" href="https://lyr-2000.github.io/post/11.%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93/mysql/%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis-conf-cn/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.8963a0cb46404a2c7f30f461e9a04aad32051004a9f78e2ca478263e3a85569d.css" rel="stylesheet"> 

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="redis conf 配置" />
<meta property="og:description" content="以下为redis.conf的文件的中文描述，整理于网络 1 2 3 4 5 6 7 8 9 10 11 12 # Redis 配置文件示例 # 注意单位: 当需要配置内存大小时, 可能需要指定" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lyr-2000.github.io/post/11.%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93/mysql/%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis-conf-cn/" />
<meta property="article:published_time" content="2021-08-17T13:48:22+08:00" />
<meta property="article:modified_time" content="2021-08-17T13:48:22+08:00" />
<meta itemprop="name" content="redis conf 配置">
<meta itemprop="description" content="以下为redis.conf的文件的中文描述，整理于网络 1 2 3 4 5 6 7 8 9 10 11 12 # Redis 配置文件示例 # 注意单位: 当需要配置内存大小时, 可能需要指定">
<meta itemprop="datePublished" content="2021-08-17T13:48:22&#43;08:00" />
<meta itemprop="dateModified" content="2021-08-17T13:48:22&#43;08:00" />
<meta itemprop="wordCount" content="9856">



<meta itemprop="keywords" content="redis," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="redis conf 配置"/>
<meta name="twitter:description" content="以下为redis.conf的文件的中文描述，整理于网络 1 2 3 4 5 6 7 8 9 10 11 12 # Redis 配置文件示例 # 注意单位: 当需要配置内存大小时, 可能需要指定"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">

</head>
<body>
  <div>
    <button class="button pink back">back</button>
    <button class="button pink go">go</button>
  </div>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">凌冬的博客</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><li style="display:inline-block;margin-right:10px;">
			<input type="search" class="mob-docsearch-input" placeholder="Search" />
		</li><a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档页</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a><a href="/friends">
        <li class="mobile-menu-item">大佬</li>
      </a>
	
	
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">凌冬的博客</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/friends">大佬</a>
      </li><li  style="list-style: none;position: relative;left: 360px;bottom: 32px;">
		<input type="search" class="docsearch-input PC_MARK1" placeholder="Search" />
	  </li></ul>
</nav>
<link rel="stylesheet" href="/custom/css/post.css">

<style>
  .mob-docsearch-input {
	border: 1px solid #ccc;
	padding: 6px 0px;
	border-radius: 3px;
	padding-left:5px;
	position: relative;
    vertical-align: top;
    width: 93%;
    margin: auto;
    margin-left: 7px;
  
  }
  input.PC_MARK1{
	border: 1px solid #ccc;
	padding: 6px 0px;
	border-radius: 3px;
	padding-left:5px;
	-webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
	box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
	-webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
	-o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
	transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s
}
input.PC_MARK1:focus{
		border-color: #66afe9;
		outline: 0;
		-webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
		box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)
}
</style>

    </header>
	
	

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">redis conf 配置</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-08-17 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#includes">INCLUDES</a></li>
    <li><a href="#general">GENERAL</a></li>
    <li><a href="#snapshotting">SNAPSHOTTING</a></li>
    <li><a href="#replication">REPLICATION</a></li>
    <li><a href="#security">SECURITY</a></li>
    <li><a href="#limits">LIMITS</a></li>
    <li><a href="#append-only-mode">APPEND ONLY MODE</a></li>
    <li><a href="#slow-log">SLOW LOG</a></li>
    <li><a href="#event-notification">Event notification</a></li>
    <li><a href="#advanced-config">ADVANCED CONFIG</a></li>
  </ul>
</nav>
  </div>
</div>

    <div class="post-content">
      <blockquote>
<p>以下为<code>redis.conf</code>的文件的中文描述，整理于网络</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Redis 配置文件示例</span>

<span class="c1"># 注意单位: 当需要配置内存大小时, 可能需要指定像1k,5GB,4M等常见格式</span>
#
<span class="c1"># 1k =&gt; 1000 bytes</span>
<span class="c1"># 1kb =&gt; 1024 bytes</span>
<span class="c1"># 1m =&gt; 1000000 bytes</span>
<span class="c1"># 1mb =&gt; 1024*1024 bytes</span>
<span class="c1"># 1g =&gt; 1000000000 bytes</span>
<span class="c1"># 1gb =&gt; 1024*1024*1024 bytes</span>
#
<span class="c1"># 单位是对大小写不敏感的 1GB 1Gb 1gB 是相同的。</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="includes">INCLUDES</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">################################## INCLUDES ###################################</span>

<span class="c1"># 可以在这里包含一个或多个其他的配置文件。如果你有一个适用于所有Redis服务器的标准配置模板</span>
<span class="c1"># 但也需要一些每个服务器自定义的设置，这个功能将很有用。被包含的配置文件也可以包含其他配置文件，</span>
<span class="c1"># 所以需要谨慎的使用这个功能。</span>
#
<span class="c1"># 注意“inclue”选项不能被admin或Redis哨兵的&#34;CONFIG REWRITE&#34;命令重写。</span>
<span class="c1"># 因为Redis总是使用最后解析的配置行最为配置指令的值, 你最好在这个文件的开头配置includes来</span>
<span class="c1"># 避免它在运行时重写配置。</span>
<span class="c1"># 如果相反你想用includes的配置覆盖原来的配置，你最好在该文件的最后使用include</span>
#
<span class="c1"># include /path/to/local.conf</span>
<span class="c1"># include /path/to/other.conf</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="general">GENERAL</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">################################ GENERAL  #####################################</span>

<span class="c1"># 默认Rdis不会作为守护进程运行。如果需要的话配置成&#39;yes&#39;</span>
<span class="c1"># 注意配置成守护进程后Redis会将进程号写入文件/var/run/redis.pid</span>
daemonize no

<span class="c1"># 当以守护进程方式运行时，默认Redis会把进程ID写到 /var/run/redis.pid。你可以在这里修改路径。</span>
pidfile /var/run/redis.pid

<span class="c1"># 接受连接的特定端口，默认是6379</span>
<span class="c1"># 如果端口设置为0，Redis就不会监听TCP套接字。</span>
port <span class="m">6379</span>

<span class="c1"># TCP listen() backlog.</span>
#
<span class="c1"># 在高并发环境下你需要一个高backlog值来避免慢客户端连接问题。注意Linux内核默默地将这个值减小</span>
<span class="c1"># 到/proc/sys/net/core/somaxconn的值，所以需要确认增大somaxconn和tcp_max_syn_backlog</span>
<span class="c1"># 两个值来达到想要的效果。</span>
tcp-backlog <span class="m">511</span>

<span class="c1"># 默认Redis监听服务器上所有可用网络接口的连接。可以用&#34;bind&#34;配置指令跟一个或多个ip地址来实现</span>
<span class="c1"># 监听一个或多个网络接口</span>
#
<span class="c1"># 示例:</span>
#
<span class="c1"># bind 192.168.1.100 10.0.0.1</span>
<span class="c1"># bind 127.0.0.1</span>

<span class="c1"># 指定用来监听Unix套套接字的路径。没有默认值， 所以在没有指定的情况下Redis不会监听Unix套接字</span>
#
<span class="c1"># unixsocket /tmp/redis.sock</span>
<span class="c1"># unixsocketperm 755</span>

<span class="c1"># 一个客户端空闲多少秒后关闭连接。(0代表禁用，永不关闭)</span>
timeout <span class="m">0</span>

<span class="c1"># TCP keepalive.</span>
#
<span class="c1"># 如果非零，则设置SO_KEEPALIVE选项来向空闲连接的客户端发送ACK，由于以下两个原因这是很有用的：</span>
#
<span class="c1"># 1）能够检测无响应的对端</span>
<span class="c1"># 2）让该连接中间的网络设备知道这个连接还存活</span>
#
<span class="c1"># 在Linux上，这个指定的值(单位：秒)就是发送ACK的时间间隔。</span>
<span class="c1"># 注意：要关闭这个连接需要两倍的这个时间值。</span>
<span class="c1"># 在其他内核上这个时间间隔由内核配置决定</span>
#
<span class="c1"># 这个选项的一个合理值是60秒</span>
tcp-keepalive <span class="m">0</span>

<span class="c1"># 指定服务器调试等级</span>
<span class="c1"># 可能值：</span>
<span class="c1"># debug （大量信息，对开发/测试有用）</span>
<span class="c1"># verbose （很多精简的有用信息，但是不像debug等级那么多）</span>
<span class="c1"># notice （适量的信息，基本上是你生产环境中需要的）</span>
<span class="c1"># warning （只有很重要/严重的信息会记录下来）</span>
loglevel notice

<span class="c1"># 指明日志文件名。也可以使用&#34;stdout&#34;来强制让Redis把日志信息写到标准输出上。</span>
<span class="c1"># 注意:如果Redis以守护进程方式运行，而设置日志显示到标准输出的话，日志会发送到/dev/null</span>
logfile <span class="s2">&#34;&#34;</span>

<span class="c1"># 要使用系统日志记录器，只要设置 &#34;syslog-enabled&#34; 为 &#34;yes&#34; 就可以了。</span>
<span class="c1"># 然后根据需要设置其他一些syslog参数就可以了。</span>
<span class="c1"># syslog-enabled no</span>

<span class="c1"># 指明syslog身份</span>
<span class="c1"># syslog-ident redis</span>

<span class="c1"># 指明syslog的设备。必须是user或LOCAL0 ~ LOCAL7之一。</span>
<span class="c1"># syslog-facility local0</span>

<span class="c1"># 设置数据库个数。默认数据库是 DB 0，</span>
<span class="c1"># 可以通过select &lt;dbid&gt;  (0 &lt;= dbid &lt;= &#39;databases&#39; - 1 ）来为每个连接使用不同的数据库。</span>
databases <span class="m">16</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="snapshotting">SNAPSHOTTING</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">################################ SNAPSHOTTING  ################################</span>
#
<span class="c1"># 把数据库存到磁盘上:</span>
#
<span class="c1">#   save &lt;seconds&gt; &lt;changes&gt;</span>
#   
<span class="c1">#   会在指定秒数和数据变化次数之后把数据库写到磁盘上。</span>
#
<span class="c1">#   下面的例子将会进行把数据写入磁盘的操作:</span>
<span class="c1">#   900秒（15分钟）之后，且至少1次变更</span>
<span class="c1">#   300秒（5分钟）之后，且至少10次变更</span>
<span class="c1">#   60秒之后，且至少10000次变更</span>
#
<span class="c1">#   注意：你要想不写磁盘的话就把所有 &#34;save&#34; 设置注释掉就行了。</span>
#
<span class="c1">#   通过添加一条带空字符串参数的save指令也能移除之前所有配置的save指令</span>
<span class="c1">#   像下面的例子：</span>
<span class="c1">#   save &#34;&#34;</span> 

save <span class="m">900</span> <span class="m">1</span>
save <span class="m">300</span> <span class="m">10</span>
save <span class="m">60</span> <span class="m">10000</span>

<span class="c1"># 默认如果开启RDB快照(至少一条save指令)并且最新的后台保存失败，Redis将会停止接受写操作</span>
<span class="c1"># 这将使用户知道数据没有正确的持久化到硬盘，否则可能没人注意到并且造成一些灾难。</span>
#
<span class="c1"># 如果后台保存进程能重新开始工作，Redis将自动允许写操作</span>
#
<span class="c1"># 然而如果你已经部署了适当的Redis服务器和持久化的监控，你可能想关掉这个功能以便于即使是</span>
<span class="c1"># 硬盘，权限等出问题了Redis也能够像平时一样正常工作，</span>
stop-writes-on-bgsave-error yes

<span class="c1"># 当导出到 .rdb 数据库时是否用LZF压缩字符串对象？</span>
<span class="c1"># 默认设置为 &#34;yes&#34;，因为几乎在任何情况下它都是不错的。</span>
<span class="c1"># 如果你想节省CPU的话你可以把这个设置为 &#34;no&#34;，但是如果你有可压缩的key和value的话，</span>
<span class="c1"># 那数据文件就会更大了。</span>
rdbcompression yes

<span class="c1"># 因为版本5的RDB有一个CRC64算法的校验和放在了文件的最后。这将使文件格式更加可靠但在</span>
<span class="c1"># 生产和加载RDB文件时，这有一个性能消耗(大约10%)，所以你可以关掉它来获取最好的性能。</span>
#
<span class="c1"># 生成的关闭校验的RDB文件有一个0的校验和，它将告诉加载代码跳过检查</span>
rdbchecksum yes

<span class="c1"># 持久化数据库的文件名</span>
dbfilename dump.rdb

<span class="c1"># 工作目录</span>
#
<span class="c1"># 数据库会写到这个目录下，文件名就是上面的 &#34;dbfilename&#34; 的值。</span>
# 
<span class="c1"># 累加文件也放这里。</span>
# 
<span class="c1"># 注意你这里指定的必须是目录，不是文件名。</span>
dir ./
</code></pre></td></tr></table>
</div>
</div><h1 id="replication">REPLICATION</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">################################# REPLICATION #################################</span>
<span class="c1"># 主从同步。通过 slaveof 指令来实现Redis实例的备份。</span>
<span class="c1"># 注意，这里是本地从远端复制数据。也就是说，本地可以有不同的数据库文件、绑定不同的IP、监听</span>
<span class="c1"># 不同的端口。</span>
#
<span class="c1"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span>

<span class="c1"># 如果master设置了密码保护（通过 &#34;requirepass&#34; 选项来配置），那么slave在开始同步之前必须</span>
<span class="c1"># 进行身份验证，否则它的同步请求会被拒绝。</span>
#
<span class="c1"># masterauth &lt;master-password&gt;</span>

<span class="c1"># 当一个slave失去和master的连接，或者同步正在进行中，slave的行为有两种可能：</span>
#
<span class="c1"># 1) 如果 slave-serve-stale-data 设置为 &#34;yes&#34; (默认值)，slave会继续响应客户端请求，</span>
<span class="c1">#    可能是正常数据，也可能是还没获得值的空数据。</span>
<span class="c1"># 2) 如果 slave-serve-stale-data 设置为 &#34;no&#34;，slave会回复&#34;正在从master同步</span>
<span class="c1">#   （SYNC with master in progress）&#34;来处理各种请求，除了 INFO 和 SLAVEOF 命令。</span>
#
slave-serve-stale-data yes

<span class="c1"># 你可以配置salve实例是否接受写操作。可写的slave实例可能对存储临时数据比较有用(因为写入salve</span>
<span class="c1"># 的数据在同master同步之后将很容被删除)，但是如果客户端由于配置错误在写入时也可能产生一些问题。</span>
#
<span class="c1"># 从Redis2.6默认所有的slave为只读</span>
#
<span class="c1"># 注意:只读的slave不是为了暴露给互联网上不可信的客户端而设计的。它只是一个防止实例误用的保护层。</span>
<span class="c1"># 一个只读的slave支持所有的管理命令比如config,debug等。为了限制你可以用&#39;rename-command&#39;来</span>
<span class="c1"># 隐藏所有的管理和危险命令来增强只读slave的安全性</span>
slave-read-only yes

<span class="c1"># slave根据指定的时间间隔向master发送ping请求。</span>
<span class="c1"># 时间间隔可以通过 repl_ping_slave_period 来设置。</span>
<span class="c1"># 默认10秒。</span>
#
<span class="c1"># repl-ping-slave-period 10</span>

<span class="c1"># 以下选项设置同步的超时时间</span>
#
<span class="c1"># 1）slave在与master SYNC期间有大量数据传输，造成超时</span>
<span class="c1"># 2）在slave角度，master超时，包括数据、ping等</span>
<span class="c1"># 3）在master角度，slave超时，当master发送REPLCONF ACK pings</span>
# 
<span class="c1"># 确保这个值大于指定的repl-ping-slave-period，否则在主从间流量不高时每次都会检测到超时</span>
#
<span class="c1"># repl-timeout 60</span>

<span class="c1"># 是否在slave套接字发送SYNC之后禁用 TCP_NODELAY ？</span>
#
<span class="c1"># 如果你选择“yes”Redis将使用更少的TCP包和带宽来向slaves发送数据。但是这将使数据传输到slave</span>
<span class="c1"># 上有延迟，Linux内核的默认配置会达到40毫秒</span>
#
<span class="c1"># 如果你选择了 &#34;no&#34; 数据传输到salve的延迟将会减少但要使用更多的带宽</span>
#
<span class="c1"># 默认我们会为低延迟做优化，但高流量情况或主从之间的跳数过多时，把这个选项设置为“yes”</span>
<span class="c1"># 是个不错的选择。</span>
repl-disable-tcp-nodelay no

<span class="c1"># 设置数据备份的backlog大小。backlog是一个slave在一段时间内断开连接时记录salve数据的缓冲，</span>
<span class="c1"># 所以一个slave在重新连接时，不必要全量的同步，而是一个增量同步就足够了，将在断开连接的这段</span>
<span class="c1"># 时间内slave丢失的部分数据传送给它。</span>
#
<span class="c1"># 同步的backlog越大，slave能够进行增量同步并且允许断开连接的时间就越长。</span>
#
<span class="c1"># backlog只分配一次并且至少需要一个slave连接</span>
#
<span class="c1"># repl-backlog-size 1mb</span>

<span class="c1"># 当master在一段时间内不再与任何slave连接，backlog将会释放。以下选项配置了从最后一个</span>
<span class="c1"># slave断开开始计时多少秒后，backlog缓冲将会释放。</span>
#
<span class="c1"># 0表示永不释放backlog</span>
#
<span class="c1"># repl-backlog-ttl 3600</span>

<span class="c1"># slave的优先级是一个整数展示在Redis的Info输出中。如果master不再正常工作了，哨兵将用它来</span>
<span class="c1"># 选择一个slave提升=升为master。</span>
#
<span class="c1"># 优先级数字小的salve会优先考虑提升为master，所以例如有三个slave优先级分别为10，100，25，</span>
<span class="c1"># 哨兵将挑选优先级最小数字为10的slave。</span>
#
<span class="c1"># 0作为一个特殊的优先级，标识这个slave不能作为master，所以一个优先级为0的slave永远不会被</span>
<span class="c1"># 哨兵挑选提升为master</span>
#
<span class="c1"># 默认优先级为100</span>
slave-priority <span class="m">100</span>

<span class="c1"># 如果master少于N个延时小于等于M秒的已连接slave，就可以停止接收写操作。</span>
#
<span class="c1"># N个slave需要是“oneline”状态</span>
#
<span class="c1"># 延时是以秒为单位，并且必须小于等于指定值，是从最后一个从slave接收到的ping（通常每秒发送）</span>
<span class="c1"># 开始计数。</span>
#
<span class="c1"># This option does not GUARANTEES that N replicas will accept the write, but</span>
<span class="c1"># will limit the window of exposure for lost writes in case not enough slaves</span>
<span class="c1"># are available, to the specified number of seconds.</span>
#
<span class="c1"># 例如至少需要3个延时小于等于10秒的slave用下面的指令：</span>
#
<span class="c1"># min-slaves-to-write 3</span>
<span class="c1"># min-slaves-max-lag 10</span>
#
<span class="c1"># 两者之一设置为0将禁用这个功能。</span>
#
<span class="c1"># 默认 min-slaves-to-write 值是0（该功能禁用）并且 min-slaves-max-lag 值是10。</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="security">SECURITY</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">################################## SECURITY ###################################</span>

<span class="c1"># 要求客户端在处理任何命令时都要验证身份和密码。</span>
<span class="c1"># 这个功能在有你不信任的其它客户端能够访问redis服务器的环境里非常有用。</span>
#

<span class="c1"># 为了向后兼容的话这段应该注释掉。而且大多数人不需要身份验证(例如:它们运行在自己的服务器上)</span>
# 
<span class="c1"># 警告：因为Redis太快了，所以外面的人可以尝试每秒150k的密码来试图破解密码。这意味着你需要</span>
<span class="c1"># 一个高强度的密码，否则破解太容易了。</span>
#
<span class="c1"># requirepass foobared</span>

<span class="c1"># 命令重命名</span>
#
<span class="c1"># 在共享环境下，可以为危险命令改变名字。比如，你可以为 CONFIG 改个其他不太容易猜到的名字，</span>
<span class="c1"># 这样内部的工具仍然可以使用，而普通的客户端将不行。</span>
#
<span class="c1"># 例如：</span>
#
<span class="c1"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span>
#
<span class="c1"># 也可以通过改名为空字符串来完全禁用一个命令</span>
#
<span class="c1"># rename-command CONFIG &#34;&#34;</span>
#
<span class="c1"># 请注意：改变命令名字被记录到AOF文件或被传送到从服务器可能产生问题。</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="limits">LIMITS</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">################################### LIMITS ####################################</span>

<span class="c1"># 设置最多同时连接的客户端数量。默认这个限制是10000个客户端，然而如果Redis服务器不能配置</span>
<span class="c1"># 处理文件的限制数来满足指定的值，那么最大的客户端连接数就被设置成当前文件限制数减32（因</span>
<span class="c1"># 为Redis服务器保留了一些文件描述符作为内部使用）</span>
#
<span class="c1"># 一旦达到这个限制，Redis会关闭所有新连接并发送错误&#39;max number of clients reached&#39;</span>
#
<span class="c1"># maxclients 10000</span>

<span class="c1"># 不要用比设置的上限更多的内存。一旦内存使用达到上限，Redis会根据选定的回收策略（参见：</span>
<span class="c1"># maxmemmory-policy）删除key</span>
#
<span class="c1"># 如果因为删除策略Redis无法删除key，或者策略设置为 &#34;noeviction&#34;，Redis会回复需要更</span>
<span class="c1"># 多内存的错误信息给命令。例如，SET,LPUSH等等，但是会继续响应像Get这样的只读命令。</span>
#
<span class="c1"># 在使用Redis作为LRU缓存，或者为实例设置了硬性内存限制的时候（使用 &#34;noeviction&#34; 策略）</span>
<span class="c1"># 的时候，这个选项通常事很有用的。</span>
#
<span class="c1"># 警告：当有多个slave连上达到内存上限的实例时，master为同步slave的输出缓冲区所需</span>
<span class="c1"># 内存不计算在使用内存中。这样当驱逐key时，就不会因网络问题 / 重新同步事件触发驱逐key</span>
<span class="c1"># 的循环，反过来slaves的输出缓冲区充满了key被驱逐的DEL命令，这将触发删除更多的key，</span>
<span class="c1"># 直到这个数据库完全被清空为止</span>
# 
<span class="c1"># 总之...如果你需要附加多个slave，建议你设置一个稍小maxmemory限制，这样系统就会有空闲</span>
<span class="c1"># 的内存作为slave的输出缓存区(但是如果最大内存策略设置为&#34;noeviction&#34;的话就没必要了)</span>
#
<span class="c1"># maxmemory &lt;bytes&gt;</span>

<span class="c1"># 最大内存策略：如果达到内存限制了，Redis如何选择删除key。你可以在下面五个行为里选：</span>
# 
<span class="c1"># volatile-lru -&gt; 根据LRU算法生成的过期时间来删除。</span>
<span class="c1"># allkeys-lru -&gt; 根据LRU算法删除任何key。</span>
<span class="c1"># volatile-random -&gt; 根据过期设置来随机删除key。</span> 
<span class="c1"># allkeys-&gt;random -&gt; 无差别随机删。</span> 
<span class="c1"># volatile-ttl -&gt; 根据最近过期时间来删除（辅以TTL）</span> 
<span class="c1"># noeviction -&gt; 谁也不删，直接在写操作时返回错误。</span>
# 
<span class="c1"># 注意：对所有策略来说，如果Redis找不到合适的可以删除的key都会在写操作时返回一个错误。</span>
#

<span class="c1">#       目前为止涉及的命令：set setnx setex append</span>
<span class="c1">#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span>
<span class="c1">#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span>
<span class="c1">#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span>
<span class="c1">#       getset mset msetnx exec sort</span>
#

<span class="c1"># 默认值如下：</span>
#
<span class="c1"># maxmemory-policy volatile-lru</span>

<span class="c1"># LRU和最小TTL算法的实现都不是很精确，但是很接近（为了省内存），所以你可以用样本量做检测。</span>
<span class="c1"># 例如：默认Redis会检查3个key然后取最旧的那个，你可以通过下面的配置指令来设置样本的个数。</span>
#
<span class="c1"># maxmemory-samples 3</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="append-only-mode">APPEND ONLY MODE</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">############################## APPEND ONLY MODE ###############################</span>

<span class="c1"># 默认情况下，Redis是异步的把数据导出到磁盘上。这种模式在很多应用里已经足够好，但Redis进程</span>
<span class="c1"># 出问题或断电时可能造成一段时间的写操作丢失(这取决于配置的save指令)。</span>
#
<span class="c1"># AOF是一种提供了更可靠的替代持久化模式，例如使用默认的数据写入文件策略（参见后面的配置）</span>
<span class="c1"># 在遇到像服务器断电或单写情况下Redis自身进程出问题但操作系统仍正常运行等突发事件时，Redis</span>
<span class="c1"># 能只丢失1秒的写操作。</span>
#
<span class="c1"># AOF和RDB持久化能同时启动并且不会有问题。</span>
<span class="c1"># 如果AOF开启，那么在启动时Redis将加载AOF文件，它更能保证数据的可靠性。</span>
#
<span class="c1"># 请查看 http://redis.io/topics/persistence 来获取更多信息.</span>

appendonly no

<span class="c1"># 纯累加文件名字（默认：&#34;appendonly.aof&#34;）</span>

appendfilename <span class="s2">&#34;appendonly.aof&#34;</span>

<span class="c1"># fsync() 系统调用告诉操作系统把数据写到磁盘上，而不是等更多的数据进入输出缓冲区。</span>
<span class="c1"># 有些操作系统会真的把数据马上刷到磁盘上；有些则会尽快去尝试这么做。</span>
#
<span class="c1"># Redis支持三种不同的模式：</span>
#
<span class="c1"># no：不要立刻刷，只有在操作系统需要刷的时候再刷。比较快。</span>
<span class="c1"># always：每次写操作都立刻写入到aof文件。慢，但是最安全。</span>
<span class="c1"># everysec：每秒写一次。折中方案。</span> 
#
<span class="c1"># 默认的 &#34;everysec&#34; 通常来说能在速度和数据安全性之间取得比较好的平衡。根据你的理解来</span>
<span class="c1"># 决定，如果你能放宽该配置为&#34;no&#34; 来获取更好的性能(但如果你能忍受一些数据丢失，可以考虑使用</span>
<span class="c1"># 默认的快照持久化模式)，或者相反，用“always”会比较慢但比everysec要更安全。</span>
#
<span class="c1"># 请查看下面的文章来获取更多的细节</span>
<span class="c1"># http://antirez.com/post/redis-persistence-demystified.html</span> 
# 
<span class="c1"># 如果不能确定，就用 &#34;everysec&#34;</span>

<span class="c1"># appendfsync always</span>
appendfsync everysec
<span class="c1"># appendfsync no</span>

<span class="c1"># 如果AOF的同步策略设置成 &#34;always&#34; 或者 &#34;everysec&#34;，并且后台的存储进程（后台存储或写入AOF</span>
<span class="c1"># 日志）会产生很多磁盘I/O开销。某些Linux的配置下会使Redis因为 fsync()系统调用而阻塞很久。</span>
<span class="c1"># 注意，目前对这个情况还没有完美修正，甚至不同线程的 fsync() 会阻塞我们同步的write(2)调用。</span>
#
<span class="c1"># 为了缓解这个问题，可以用下面这个选项。它可以在 BGSAVE 或 BGREWRITEAOF 处理时阻止fsync()。</span>
# 
<span class="c1"># 这就意味着如果有子进程在进行保存操作，那么Redis就处于&#34;不可同步&#34;的状态。</span>
<span class="c1"># 这实际上是说，在最差的情况下可能会丢掉30秒钟的日志数据。（默认Linux设定）</span>
# 
<span class="c1"># 如果把这个设置成&#34;yes&#34;带来了延迟问题，就保持&#34;no&#34;，这是保存持久数据的最安全的方式。</span>

no-appendfsync-on-rewrite no

<span class="c1"># 自动重写AOF文件</span>
<span class="c1"># 如果AOF日志文件增大到指定百分比，Redis能够通过 BGREWRITEAOF 自动重写AOF日志文件。</span>
# 
<span class="c1"># 工作原理：Redis记住上次重写时AOF文件的大小（如果重启后还没有写操作，就直接用启动时的AOF大小）</span>
# 
<span class="c1"># 这个基准大小和当前大小做比较。如果当前大小超过指定比例，就会触发重写操作。你还需要指定被重写</span>
<span class="c1"># 日志的最小尺寸，这样避免了达到指定百分比但尺寸仍然很小的情况还要重写。</span>
#
<span class="c1"># 指定百分比为0会禁用AOF自动重写特性。</span>

auto-aof-rewrite-percentage <span class="m">100</span>
auto-aof-rewrite-min-size 64mb

<span class="c1">################################ LUA SCRIPTING  ###############################</span>

<span class="c1"># Lua 脚本的最大执行时间，毫秒为单位</span>
#
<span class="c1"># 如果达到了最大的执行时间，Redis将要记录在达到最大允许时间之后一个脚本仍然在执行，并且将</span>
<span class="c1"># 开始对查询进行错误响应。</span>
#
<span class="c1"># 当一个长时间运行的脚本超过了最大执行时间，只有 SCRIPT KILL 和 SHUTDOWN NOSAVE 两个</span>
<span class="c1"># 命令可用。第一个可以用于停止一个还没有调用写命名的脚本。第二个是关闭服务器唯一方式，当</span>
<span class="c1"># 写命令已经通过脚本开始执行，并且用户不想等到脚本的自然终止。</span>
#
<span class="c1"># 设置成0或者负值表示不限制执行时间并且没有任何警告</span>
lua-time-limit <span class="m">5000</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="slow-log">SLOW LOG</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">################################## SLOW LOG ###################################</span>

<span class="c1"># Redis慢查询日志可以记录超过指定时间的查询。运行时间不包括各种I/O时间，例如：连接客户端，</span>
<span class="c1"># 发送响应数据等，而只计算命令执行的实际时间（这只是线程阻塞而无法同时为其他请求服务的命令执</span>
<span class="c1"># 行阶段）</span>
# 
<span class="c1"># 你可以为慢查询日志配置两个参数:一个指明Redis的超时时间(单位为微秒)来记录超过这个时间的命令</span>
<span class="c1"># 另一个是慢查询日志长度。当一个新的命令被写进日志的时候，最老的那个记录从队列中移除。</span>
#
<span class="c1"># 下面的时间单位是微秒，所以1000000就是1秒。注意，负数时间会禁用慢查询日志，而0则会强制记录</span>
<span class="c1"># 所有命令。</span>
slowlog-log-slower-than <span class="m">10000</span>

<span class="c1"># 这个长度没有限制。只是要主要会消耗内存。你可以通过 SLOWLOG RESET 来回收内存。</span>
slowlog-max-len <span class="m">128</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="event-notification">Event notification</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">############################# Event notification ##############################</span>

<span class="c1"># Redis 能通知 Pub/Sub 客户端关于键空间发生的事件</span>
<span class="c1"># 这个功能文档位于http://redis.io/topics/keyspace-events</span>
#
<span class="c1"># 例如：如果键空间事件通知被开启，并且客户端对 0 号数据库的键 foo 执行 DEL 命令时，将通过</span>
<span class="c1"># Pub/Sub发布两条消息：</span>
<span class="c1"># PUBLISH __keyspace@0__:foo del</span>
<span class="c1"># PUBLISH __keyevent@0__:del foo</span>
#
<span class="c1"># 可以在下表中选择Redis要通知的事件类型。事件类型由单个字符来标识：</span>
#
<span class="c1"># K    键空间通知，以__keyspace@&lt;db&gt;__为前缀</span>
<span class="c1"># E    键事件通知，以__keysevent@&lt;db&gt;__为前缀</span>
<span class="c1"># g    DEL , EXPIRE , RENAME 等类型无关的通用命令的通知, ...</span>
<span class="c1"># $    String命令</span>
<span class="c1"># l    List命令</span>
<span class="c1"># s    Set命令</span>
<span class="c1"># h    Hash命令</span>
<span class="c1"># z    有序集合命令</span>
<span class="c1"># x    过期事件（每次key过期时生成）</span>
<span class="c1"># e    驱逐事件（当key在内存满了被清除时生成）</span>
<span class="c1"># A    g$lshzxe的别名，因此”AKE”意味着所有的事件</span>
#
<span class="c1"># notify-keyspace-events 带一个由0到多个字符组成的字符串参数。空字符串意思是通知被禁用。</span>
#
<span class="c1"># 例子：启用List和通用事件通知：</span>
<span class="c1"># notify-keyspace-events Elg</span>
#
<span class="c1"># 例子2：为了获取过期key的通知订阅名字为 __keyevent@__:expired 的频道，用以下配置</span>
<span class="c1"># notify-keyspace-events Ex</span>
#
<span class="c1"># 默认所用的通知被禁用，因为用户通常不需要该特性，并且该特性会有性能损耗。</span>
<span class="c1"># 注意如果你不指定至少K或E之一，不会发送任何事件。</span>
notify-keyspace-events <span class="s2">&#34;&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="advanced-config">ADVANCED CONFIG</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 当hash只有少量的entry时，并且最大的entry所占空间没有超过指定的限制时，会用一种节省内存的</span>
<span class="c1"># 数据结构来编码。可以通过下面的指令来设定限制</span>
hash-max-ziplist-entries <span class="m">512</span>
hash-max-ziplist-value <span class="m">64</span>

<span class="c1"># 与hash似，数据元素较少的list，可以用另一种方式来编码从而节省大量空间。</span>
<span class="c1"># 这种特殊的方式只有在符合下面限制时才可以用：</span>
list-max-ziplist-entries <span class="m">512</span>
list-max-ziplist-value <span class="m">64</span>

<span class="c1"># set有一种特殊编码的情况：当set数据全是十进制64位有符号整型数字构成的字符串时。</span>
<span class="c1"># 下面这个配置项就是用来设置set使用这种编码来节省内存的最大长度。</span>
set-max-intset-entries <span class="m">512</span>

<span class="c1"># 与hash和list相似，有序集合也可以用一种特别的编码方式来节省大量空间。</span>
<span class="c1"># 这种编码只适合长度和元素都小于下面限制的有序集合：</span>
zset-max-ziplist-entries <span class="m">128</span>
zset-max-ziplist-value <span class="m">64</span>

<span class="c1"># HyperLogLog sparse representation bytes limit. The limit includes the</span>
<span class="c1"># 16 bytes header. When an HyperLogLog using the sparse representation crosses</span>
<span class="c1"># this limit, it is converted into the dense representation.</span>
#
<span class="c1"># A value greater than 16000 is totally useless, since at that point the</span>
<span class="c1"># dense representation is more memory efficient.</span>
# 
<span class="c1"># The suggested value is ~ 3000 in order to have the benefits of</span>
<span class="c1"># the space efficient encoding without slowing down too much PFADD,</span>
<span class="c1"># which is O(N) with the sparse encoding. The value can be raised to</span>
<span class="c1"># ~ 10000 when CPU is not a concern, but space is, and the data set is</span>
<span class="c1"># composed of many HyperLogLogs with cardinality in the 0 - 15000 range.</span>
hll-sparse-max-bytes <span class="m">3000</span>

<span class="c1"># 启用哈希刷新，每100个CPU毫秒会拿出1个毫秒来刷新Redis的主哈希表（顶级键值映射表）。</span>
<span class="c1"># redis所用的哈希表实现（见dict.c）采用延迟哈希刷新机制：你对一个哈希表操作越多，哈希刷新</span>
<span class="c1"># 操作就越频繁；反之，如果服务器是空闲的，那么哈希刷新就不会完成，哈希表就会占用更多的一些</span>
<span class="c1"># 内存而已。</span>
# 
<span class="c1"># 默认是每秒钟进行10次哈希表刷新，用来刷新字典，然后尽快释放内存。</span>
#
<span class="c1"># 建议：</span>
<span class="c1"># 如果你对延迟比较在意，不能够接受Redis时不时的对请求有2毫秒的延迟的话，就用</span>
<span class="c1"># &#34;activerehashing no&#34;，如果不太在意延迟而希望尽快释放内存就设置&#34;activerehashing yes&#34;</span>
activerehashing yes

<span class="c1"># 客户端的输出缓冲区的限制，可用于强制断开那些因为某种原因从服务器读取数据的速度不够快的客户端，</span>
<span class="c1"># （一个常见的原因是一个发布/订阅客户端消费消息的速度无法赶上生产它们的速度）</span>
#
<span class="c1"># 可以对三种不同的客户端设置不同的限制：</span>
<span class="c1"># normal -&gt; 正常客户端</span>
<span class="c1"># slave -&gt; slave和 MONITOR 客户端</span>
<span class="c1"># pubsub -&gt; 至少订阅了一个pubsub channel或pattern的客户端</span>
#
<span class="c1"># 下面是每个client-output-buffer-limit语法:</span>
<span class="c1"># client-output-buffer-limit &lt;class&gt;&lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;</span>

<span class="c1"># 一旦达到硬限制客户端会立即被断开，或者达到软限制并持续达到指定的秒数（连续的）。</span>
<span class="c1"># 例如，如果硬限制为32兆字节和软限制为16兆字节/10秒，客户端将会立即断开</span>
<span class="c1"># 如果输出缓冲区的大小达到32兆字节，或客户端达到16兆字节并连续超过了限制10秒，就将断开连接。</span>
#
<span class="c1"># 默认normal客户端不做限制，因为他们在不主动请求时不接收数据（以推的方式），只有异步客户端</span>
<span class="c1"># 可能会出现请求数据的速度比它可以读取的速度快的场景。</span>
#
<span class="c1"># pubsub和slave客户端会有一个默认值，因为订阅者和slaves以推的方式来接收数据</span>
#
<span class="c1"># 把硬限制和软限制都设置为0来禁用该功能</span>
client-output-buffer-limit normal <span class="m">0</span> <span class="m">0</span> <span class="m">0</span>
client-output-buffer-limit slave 256mb 64mb <span class="m">60</span>
client-output-buffer-limit pubsub 32mb 8mb <span class="m">60</span>

<span class="c1"># Redis调用内部函数来执行许多后台任务，如关闭客户端超时的连接，清除未被请求过的过期Key等等。</span>
#
<span class="c1"># 不是所有的任务都以相同的频率执行，但Redis依照指定的“hz”值来执行检查任务。</span>
#
<span class="c1"># 默认情况下，“hz”的被设定为10。提高该值将在Redis空闲时使用更多的CPU时，但同时当有多个key</span>
<span class="c1"># 同时到期会使Redis的反应更灵敏，以及超时可以更精确地处理。</span>
#
<span class="c1"># 范围是1到500之间，但是值超过100通常不是一个好主意。</span>
<span class="c1"># 大多数用户应该使用10这个默认值，只有在非常低的延迟要求时有必要提高到100。</span>
hz <span class="m">10</span>

<span class="c1"># 当一个子进程重写AOF文件时，如果启用下面的选项，则文件每生成32M数据会被同步。为了增量式的</span>
<span class="c1"># 写入硬盘并且避免大的延迟高峰这个指令是非常有用的</span>
aof-rewrite-incremental-fsync yes
</code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">LYR</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2021-08-17
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/redis/">redis</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/11.%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93/mysql/%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93/redis/redis-introduction/">
            <span class="next-text nav-default">redis介绍</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>

  
  
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:lyr-2000@qq.com" class="iconfont icon-email" title="email"></a>
  <a href="" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2021 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>lyr</span>
  </span>
</div>



<script 
 
    src="https://cdn.jsdelivr.net/gh/lyr-2000/live2d-widget@latest/autoload.js"></script>



    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        tags: 'ams',
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>






<script defer="defer" async src="/js/custom/docsearch.min.js" ></script>
<script defer="defer" async>
 
  window.addEventListener('load',function() {
  
	docsearch({
		apiKey: "2991187e127fb95e62db841ea946bc06",
		indexName: "blog",
		appId: "UVGAU2QDTQ",
		inputSelector: '.docsearch-input',
		debug: false,
    });
    docsearch({
	 apiKey: "2991187e127fb95e62db841ea946bc06",
	 indexName: "blog",
	 appId: "UVGAU2QDTQ",
	 inputSelector: '.mob-docsearch-input',
	 debug: false,
    });
  });
 
</script>
  <script  src="/custom/img/lazyload.min.js"></script>
  <script defer="defer" async src="/custom/post/back_btn.js"></script>
  
</body>
</html>
